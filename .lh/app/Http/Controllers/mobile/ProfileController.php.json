{
    "sourceFile": "app/Http/Controllers/mobile/ProfileController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1763565836603,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763565893180,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n <?php\n \n-namespace App\\Http\\Controllers\\mobile;\n+namespace App\\Http\\Controllers\\Api;\n \n use App\\Http\\Controllers\\Controller;\n use Illuminate\\Http\\Request;\n use Illuminate\\Support\\Facades\\Storage;\n@@ -11,108 +11,110 @@\n     /**\n      * Show the authenticated user's profile information.\n      */\n     public function show(Request $request)\n-    {\n-        $user = $request->user();\n-        \n-        // Load user_info relationship\n-        $user->load('userInfo');\n-        \n-        // Check if user is a REAL member (has QR code)\n-        $isMember = $user->userInfo && $user->userInfo->qr_code;\n-        \n-        return response()->json([\n-            'success' => true,\n-            'user' => [\n-                'id' => $user->id,\n-                'email' => $user->email,\n-                'role_id' => $user->role_id ?? null,\n-                \n-                // Basic info from users table (always available)\n-                'first_name' => $user->first_name,\n-                'middle_name' => $user->middle_name,\n-                'last_name' => $user->last_name,\n-                'suffix' => $user->suffix,\n-                \n-                // Membership info\n-                'fname' => $isMember ? $user->userInfo->fname : null,\n-                'mname' => $isMember ? $user->userInfo->mname : null,\n-                'lname' => $isMember ? $user->userInfo->lname : null,\n-                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n-                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n-                'gender' => $isMember ? $user->userInfo->gender : null,\n-                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n-                'province' => $isMember ? $user->userInfo->province : null,\n-                'city' => $isMember ? $user->userInfo->city : null,\n-                'house_no' => $isMember ? $user->userInfo->house_no : null,\n-                'barangay' => $isMember ? $user->userInfo->barangay : null,\n-                'zone' => $isMember ? $user->userInfo->zone : null,\n-                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n-                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n-                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n-                'land_size' => $isMember ? $user->userInfo->land_size : null,\n-                'water_source' => $isMember ? $user->userInfo->water_source : null,\n-                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n-                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n-                'created_at' => $isMember ? $user->userInfo->created_at : null,\n-                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n-                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n-                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n-                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n-                'relationship' => $isMember ? $user->userInfo->relationship : null,\n-                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n-                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n-                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n-                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n-                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n-                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n-                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n-                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n-            ]\n-        ]);\n-    }\n+{\n+    $user = $request->user();\n+    \n+    // Load user_info relationship\n+    $user->load('userInfo');\n+    \n+    // Check if user is a REAL member (has QR code)\n+    $isMember = $user->userInfo && $user->userInfo->qr_code;\n+    \n+    return response()->json([\n+        'success' => true,\n+        'user' => [\n+            'id' => $user->id,\n+            'email' => $user->email,\n+            'role_id' => $user->role_id ?? null,\n+            \n+            // Basic info from users table (always available)\n+            'first_name' => $user->first_name,\n+            'middle_name' => $user->middle_name,\n+            'last_name' => $user->last_name,\n+            'suffix' => $user->suffix,\n+            \n+            // Membership info (only if they're a real member with QR code)\n+            'fname' => $isMember ? $user->userInfo->fname : null,\n+            'mname' => $isMember ? $user->userInfo->mname : null,\n+            'lname' => $isMember ? $user->userInfo->lname : null,\n+            'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n+            'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n+            'gender' => $isMember ? $user->userInfo->gender : null,\n+            'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n+            'province' => $isMember ? $user->userInfo->province : null,\n+            'city' => $isMember ? $user->userInfo->city : null,\n+            'house_no' => $isMember ? $user->userInfo->house_no : null,\n+            'barangay' => $isMember ? $user->userInfo->barangay : null,\n+            'zone' => $isMember ? $user->userInfo->zone : null,\n+            'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n+            'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n+            'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n+            'land_size' => $isMember ? $user->userInfo->land_size : null,\n+            'water_source' => $isMember ? $user->userInfo->water_source : null,\n+            'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n+            'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n+            'created_at' => $isMember ? $user->userInfo->created_at : null,\n+            'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n+            'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n+            'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n+            'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n+            'relationship' => $isMember ? $user->userInfo->relationship : null,\n+            'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n+            'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n+            'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n+            'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n+            'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n+            'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n+            'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n+            'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n+        ]\n+    ]);\n+}\n \n+\n     /**\n      * Update the user's profile picture.\n      */\n     public function updatePicture(Request $request)\n-    {\n-        $request->validate([\n-            'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120',\n-        ]);\n+{\n+    $request->validate([\n+        'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120', // 5MB max\n+    ]);\n \n-        $user = $request->user();\n+    $user = $request->user();\n \n-        if (!$user->userInfo) {\n-            return response()->json([\n-                'success' => false,\n-                'message' => 'Only members can upload a profile picture.'\n-            ], 403);\n+    if (!$user->userInfo) {\n+        return response()->json([\n+            'success' => false,\n+            'message' => 'Only members can upload a profile picture.'\n+        ], 403);\n+    }\n+\n+    try {\n+        // Delete old image if exists\n+        if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n+            Storage::disk('public')->delete($user->userInfo->profile_img);\n         }\n \n-        try {\n-            // Delete old image if exists\n-            if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n-                Storage::disk('public')->delete($user->userInfo->profile_img);\n-            }\n+        // Store new image\n+        $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n+        \n+        // Update database\n+        $user->userInfo->update(['profile_img' => $path]);\n \n-            // Store new image\n-            $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n-            \n-            // Update database\n-            $user->userInfo->update(['profile_img' => $path]);\n+        return response()->json([\n+            'success' => true,\n+            'message' => 'Profile picture updated successfully.',\n+            'path' => $path,\n+            'url' => Storage::url($path),\n+        ]);\n+    } catch (\\Exception $e) {\n+        return response()->json([\n+            'success' => false,\n+            'message' => 'Upload failed: ' . $e->getMessage(),\n+        ], 500);\n+    }\n+  }\n \n-            return response()->json([\n-                'success' => true,\n-                'message' => 'Profile picture updated successfully.',\n-                'path' => $path,\n-                'url' => Storage::url($path),\n-            ]);\n-        } catch (\\Exception $e) {\n-            return response()->json([\n-                'success' => false,\n-                'message' => 'Upload failed: ' . $e->getMessage(),\n-            ], 500);\n-        }\n-    }\n }\n"
                },
                {
                    "date": 1763566110743,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n <?php\n \n-namespace App\\Http\\Controllers\\Api;\n+namespace App\\Http\\Controllers\\mobile;\n \n use App\\Http\\Controllers\\Controller;\n use Illuminate\\Http\\Request;\n use Illuminate\\Support\\Facades\\Storage;\n@@ -11,110 +11,108 @@\n     /**\n      * Show the authenticated user's profile information.\n      */\n     public function show(Request $request)\n-{\n-    $user = $request->user();\n-    \n-    // Load user_info relationship\n-    $user->load('userInfo');\n-    \n-    // Check if user is a REAL member (has QR code)\n-    $isMember = $user->userInfo && $user->userInfo->qr_code;\n-    \n-    return response()->json([\n-        'success' => true,\n-        'user' => [\n-            'id' => $user->id,\n-            'email' => $user->email,\n-            'role_id' => $user->role_id ?? null,\n-            \n-            // Basic info from users table (always available)\n-            'first_name' => $user->first_name,\n-            'middle_name' => $user->middle_name,\n-            'last_name' => $user->last_name,\n-            'suffix' => $user->suffix,\n-            \n-            // Membership info (only if they're a real member with QR code)\n-            'fname' => $isMember ? $user->userInfo->fname : null,\n-            'mname' => $isMember ? $user->userInfo->mname : null,\n-            'lname' => $isMember ? $user->userInfo->lname : null,\n-            'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n-            'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n-            'gender' => $isMember ? $user->userInfo->gender : null,\n-            'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n-            'province' => $isMember ? $user->userInfo->province : null,\n-            'city' => $isMember ? $user->userInfo->city : null,\n-            'house_no' => $isMember ? $user->userInfo->house_no : null,\n-            'barangay' => $isMember ? $user->userInfo->barangay : null,\n-            'zone' => $isMember ? $user->userInfo->zone : null,\n-            'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n-            'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n-            'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n-            'land_size' => $isMember ? $user->userInfo->land_size : null,\n-            'water_source' => $isMember ? $user->userInfo->water_source : null,\n-            'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n-            'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n-            'created_at' => $isMember ? $user->userInfo->created_at : null,\n-            'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n-            'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n-            'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n-            'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n-            'relationship' => $isMember ? $user->userInfo->relationship : null,\n-            'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n-            'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n-            'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n-            'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n-            'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n-            'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n-            'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n-            'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n-        ]\n-    ]);\n-}\n+    {\n+        $user = $request->user();\n+        \n+        // Load user_info relationship\n+        $user->load('userInfo');\n+        \n+        // Check if user is a REAL member (has QR code)\n+        $isMember = $user->userInfo && $user->userInfo->qr_code;\n+        \n+        return response()->json([\n+            'success' => true,\n+            'user' => [\n+                'id' => $user->id,\n+                'email' => $user->email,\n+                'role_id' => $user->role_id ?? null,\n+                \n+                // Basic info from users table (always available)\n+                'first_name' => $user->first_name,\n+                'middle_name' => $user->middle_name,\n+                'last_name' => $user->last_name,\n+                'suffix' => $user->suffix,\n+                \n+                // Membership info\n+                'fname' => $isMember ? $user->userInfo->fname : null,\n+                'mname' => $isMember ? $user->userInfo->mname : null,\n+                'lname' => $isMember ? $user->userInfo->lname : null,\n+                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n+                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n+                'gender' => $isMember ? $user->userInfo->gender : null,\n+                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n+                'province' => $isMember ? $user->userInfo->province : null,\n+                'city' => $isMember ? $user->userInfo->city : null,\n+                'house_no' => $isMember ? $user->userInfo->house_no : null,\n+                'barangay' => $isMember ? $user->userInfo->barangay : null,\n+                'zone' => $isMember ? $user->userInfo->zone : null,\n+                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n+                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n+                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n+                'land_size' => $isMember ? $user->userInfo->land_size : null,\n+                'water_source' => $isMember ? $user->userInfo->water_source : null,\n+                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n+                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n+                'created_at' => $isMember ? $user->userInfo->created_at : null,\n+                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n+                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n+                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n+                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n+                'relationship' => $isMember ? $user->userInfo->relationship : null,\n+                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n+                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n+                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n+                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n+                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n+                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n+                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n+                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n+            ]\n+        ]);\n+    }\n \n-\n     /**\n      * Update the user's profile picture.\n      */\n     public function updatePicture(Request $request)\n-{\n-    $request->validate([\n-        'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120', // 5MB max\n-    ]);\n+    {\n+        $request->validate([\n+            'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120',\n+        ]);\n \n-    $user = $request->user();\n+        $user = $request->user();\n \n-    if (!$user->userInfo) {\n-        return response()->json([\n-            'success' => false,\n-            'message' => 'Only members can upload a profile picture.'\n-        ], 403);\n-    }\n-\n-    try {\n-        // Delete old image if exists\n-        if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n-            Storage::disk('public')->delete($user->userInfo->profile_img);\n+        if (!$user->userInfo) {\n+            return response()->json([\n+                'success' => false,\n+                'message' => 'Only members can upload a profile picture.'\n+            ], 403);\n         }\n \n-        // Store new image\n-        $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n-        \n-        // Update database\n-        $user->userInfo->update(['profile_img' => $path]);\n+        try {\n+            // Delete old image if exists\n+            if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n+                Storage::disk('public')->delete($user->userInfo->profile_img);\n+            }\n \n-        return response()->json([\n-            'success' => true,\n-            'message' => 'Profile picture updated successfully.',\n-            'path' => $path,\n-            'url' => Storage::url($path),\n-        ]);\n-    } catch (\\Exception $e) {\n-        return response()->json([\n-            'success' => false,\n-            'message' => 'Upload failed: ' . $e->getMessage(),\n-        ], 500);\n+            // Store new image\n+            $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n+            \n+            // Update database\n+            $user->userInfo->update(['profile_img' => $path]);\n+\n+            return response()->json([\n+                'success' => true,\n+                'message' => 'Profile picture updated successfully.',\n+                'path' => $path,\n+                'url' => Storage::url($path),\n+            ]);\n+        } catch (\\Exception $e) {\n+            return response()->json([\n+                'success' => false,\n+                'message' => 'Upload failed: ' . $e->getMessage(),\n+            ], 500);\n+        }\n     }\n-  }\n-\n }\n"
                },
                {
                    "date": 1763566792973,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,118 @@\n+<?php\n+\n+namespace App\\Http\\Controllers\\mobile;\n+\n+use App\\Http\\Controllers\\Controller;\n+use Illuminate\\Http\\Request;\n+use Illuminate\\Support\\Facades\\Storage;\n+\n+class ProfileController extends Controller\n+{\n+    /**\n+     * Show the authenticated user's profile information.\n+     */\n+    public function show(Request $request)\n+    {\n+        $user = $request->user();\n+        \n+        // Load user_info relationship\n+        $user->load('userInfo');\n+        \n+        // Check if user is a REAL member (has QR code)\n+        $isMember = $user->userInfo && $user->userInfo->qr_code;\n+        \n+        return response()->json([\n+            'success' => true,\n+            'user' => [\n+                'id' => $user->id,\n+                'email' => $user->email,\n+                'role_id' => $user->role_id ?? null,\n+                \n+                // Basic info from users table (always available)\n+                'first_name' => $user->first_name,\n+                'middle_name' => $user->middle_name,\n+                'last_name' => $user->last_name,\n+                'suffix' => $user->suffix,\n+                \n+                // Membership info\n+                'fname' => $isMember ? $user->userInfo->fname : null,\n+                'mname' => $isMember ? $user->userInfo->mname : null,\n+                'lname' => $isMember ? $user->userInfo->lname : null,\n+                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n+                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n+                'gender' => $isMember ? $user->userInfo->gender : null,\n+                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n+                'province' => $isMember ? $user->userInfo->province : null,\n+                'city' => $isMember ? $user->userInfo->city : null,\n+                'house_no' => $isMember ? $user->userInfo->house_no : null,\n+                'barangay' => $isMember ? $user->userInfo->barangay : null,\n+                'zone' => $isMember ? $user->userInfo->zone : null,\n+                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n+                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n+                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n+                'land_size' => $isMember ? $user->userInfo->land_size : null,\n+                'water_source' => $isMember ? $user->userInfo->water_source : null,\n+                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n+                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n+                'created_at' => $isMember ? $user->userInfo->created_at : null,\n+                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n+                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n+                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n+                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n+                'relationship' => $isMember ? $user->userInfo->relationship : null,\n+                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n+                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n+                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n+                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n+                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n+                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n+                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n+                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n+            ]\n+        ]);\n+    }\n+\n+    /**\n+     * Update the user's profile picture.\n+     */\n+    public function updatePicture(Request $request)\n+    {\n+        $request->validate([\n+            'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120',\n+        ]);\n+\n+        $user = $request->user();\n+\n+        if (!$user->userInfo) {\n+            return response()->json([\n+                'success' => false,\n+                'message' => 'Only members can upload a profile picture.'\n+            ], 403);\n+        }\n+\n+        try {\n+            // Delete old image if exists\n+            if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n+                Storage::disk('public')->delete($user->userInfo->profile_img);\n+            }\n+\n+            // Store new image\n+            $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n+            \n+            // Update database\n+            $user->userInfo->update(['profile_img' => $path]);\n+\n+            return response()->json([\n+                'success' => true,\n+                'message' => 'Profile picture updated successfully.',\n+                'path' => $path,\n+                'url' => Storage::url($path),\n+            ]);\n+        } catch (\\Exception $e) {\n+            return response()->json([\n+                'success' => false,\n+                'message' => 'Upload failed: ' . $e->getMessage(),\n+            ], 500);\n+        }\n+    }\n+}\n"
                },
                {
                    "date": 1763720280238,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,61 +14,84 @@\n     public function show(Request $request)\n     {\n         $user = $request->user();\n         \n-        // Load user_info relationship\n-        $user->load('userInfo');\n+        // ✅ Load relationships\n+        $user->load(['userInfo', 'creditScore']);\n         \n-        // Check if user is a REAL member (has QR code)\n-        $isMember = $user->userInfo && $user->userInfo->qr_code;\n-        \n         return response()->json([\n             'success' => true,\n             'user' => [\n                 'id' => $user->id,\n                 'email' => $user->email,\n-                'role_id' => $user->role_id ?? null,\n+                'role_id' => $user->role_id,\n                 \n-                // Basic info from users table (always available)\n+                // Basic info from users table\n                 'first_name' => $user->first_name,\n                 'middle_name' => $user->middle_name,\n                 'last_name' => $user->last_name,\n                 'suffix' => $user->suffix,\n                 \n-                // Membership info\n-                'fname' => $isMember ? $user->userInfo->fname : null,\n-                'mname' => $isMember ? $user->userInfo->mname : null,\n-                'lname' => $isMember ? $user->userInfo->lname : null,\n-                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n-                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n-                'gender' => $isMember ? $user->userInfo->gender : null,\n-                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n-                'province' => $isMember ? $user->userInfo->province : null,\n-                'city' => $isMember ? $user->userInfo->city : null,\n-                'house_no' => $isMember ? $user->userInfo->house_no : null,\n-                'barangay' => $isMember ? $user->userInfo->barangay : null,\n-                'zone' => $isMember ? $user->userInfo->zone : null,\n-                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n-                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n-                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n-                'land_size' => $isMember ? $user->userInfo->land_size : null,\n-                'water_source' => $isMember ? $user->userInfo->water_source : null,\n-                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n-                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n-                'created_at' => $isMember ? $user->userInfo->created_at : null,\n-                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n-                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n-                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n-                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n-                'relationship' => $isMember ? $user->userInfo->relationship : null,\n-                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n-                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n-                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n-                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n-                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n-                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n-                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n-                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n+                // ✅ COMPLETE user_info with ALL fields\n+                'user_info' => $user->userInfo ? [\n+                    'id' => $user->userInfo->id,\n+                    'user_id' => $user->userInfo->user_id,\n+                    'fname' => $user->userInfo->fname,\n+                    'mname' => $user->userInfo->mname,\n+                    'lname' => $user->userInfo->lname,\n+                    'name' => $user->userInfo->name,\n+                    'suffix' => $user->userInfo->suffix,\n+                    'birthdate' => $user->userInfo->birthdate,\n+                    'civil_status' => $user->userInfo->civil_status,\n+                    'gender' => $user->userInfo->gender,\n+                    \n+                    // ✅ NEW: Contact fields\n+                    'contact_info' => $user->userInfo->contact_info,\n+                    'phone_no' => $user->userInfo->phone_no,\n+                    'email' => $user->userInfo->email,\n+                    \n+                    'province' => $user->userInfo->province,\n+                    'city' => $user->userInfo->city,\n+                    'house_no' => $user->userInfo->house_no,\n+                    'barangay' => $user->userInfo->barangay,\n+                    'zone' => $user->userInfo->zone,\n+                    'profile_img' => $user->userInfo->profile_img,\n+                    'qr_code' => $user->userInfo->qr_code,\n+                    'farmer_type' => $user->userInfo->farmer_type,\n+                    'farm_location' => $user->userInfo->farm_location,\n+                    'land_size' => $user->userInfo->land_size,\n+                    'water_source' => $user->userInfo->water_source,\n+                    \n+                    // Secondary Contact fields\n+                    'sc_fname' => $user->userInfo->sc_fname,\n+                    'sc_mname' => $user->userInfo->sc_mname,\n+                    'sc_lname' => $user->userInfo->sc_lname,\n+                    'sc_suffix' => $user->userInfo->sc_suffix,\n+                    'sc_gender' => $user->userInfo->sc_gender,\n+                    \n+                    // ✅ NEW: Secondary contact fields\n+                    'sc_contact_info' => $user->userInfo->sc_contact_info,\n+                    'sc_phone_no' => $user->userInfo->sc_phone_no,\n+                    'sc_email' => $user->userInfo->sc_email,\n+                    \n+                    'sc_province' => $user->userInfo->sc_province,\n+                    'sc_city' => $user->userInfo->sc_city,\n+                    'sc_house_no' => $user->userInfo->sc_house_no,\n+                    'sc_barangay' => $user->userInfo->sc_barangay,\n+                    'sc_zone' => $user->userInfo->sc_zone,\n+                    'relationship' => $user->userInfo->relationship,\n+                    \n+                    'created_at' => $user->userInfo->created_at,\n+                    'updated_at' => $user->userInfo->updated_at,\n+                ] : null,\n+                \n+                // ✅ Credit score\n+                'credit_score' => $user->creditScore ? [\n+                    'id' => $user->creditScore->id,\n+                    'score' => $user->creditScore->score,\n+                    'created_at' => $user->creditScore->created_at,\n+                    'updated_at' => $user->creditScore->updated_at,\n+                ] : null,\n             ]\n         ]);\n     }\n \n@@ -90,138 +113,18 @@\n             ], 403);\n         }\n \n         try {\n-            // Delete old image if exists\n             if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n                 Storage::disk('public')->delete($user->userInfo->profile_img);\n             }\n \n-            // Store new image\n             $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n-            \n-            // Update database\n             $user->userInfo->update(['profile_img' => $path]);\n \n-            return response()->json([\n-                'success' => true,\n-                'message' => 'Profile picture updated successfully.',\n-                'path' => $path,\n-                'url' => Storage::url($path),\n-            ]);\n-        } catch (\\Exception $e) {\n-            return response()->json([\n-                'success' => false,\n-                'message' => 'Upload failed: ' . $e->getMessage(),\n-            ], 500);\n-        }\n-    }\n-}\n-<?php\n+            $user->userInfo->refresh();\n \n-namespace App\\Http\\Controllers\\mobile;\n-\n-use App\\Http\\Controllers\\Controller;\n-use Illuminate\\Http\\Request;\n-use Illuminate\\Support\\Facades\\Storage;\n-\n-class ProfileController extends Controller\n-{\n-    /**\n-     * Show the authenticated user's profile information.\n-     */\n-    public function show(Request $request)\n-    {\n-        $user = $request->user();\n-        \n-        // Load user_info relationship\n-        $user->load('userInfo');\n-        \n-        // Check if user is a REAL member (has QR code)\n-        $isMember = $user->userInfo && $user->userInfo->qr_code;\n-        \n-        return response()->json([\n-            'success' => true,\n-            'user' => [\n-                'id' => $user->id,\n-                'email' => $user->email,\n-                'role_id' => $user->role_id ?? null,\n-                \n-                // Basic info from users table (always available)\n-                'first_name' => $user->first_name,\n-                'middle_name' => $user->middle_name,\n-                'last_name' => $user->last_name,\n-                'suffix' => $user->suffix,\n-                \n-                // Membership info\n-                'fname' => $isMember ? $user->userInfo->fname : null,\n-                'mname' => $isMember ? $user->userInfo->mname : null,\n-                'lname' => $isMember ? $user->userInfo->lname : null,\n-                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n-                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n-                'gender' => $isMember ? $user->userInfo->gender : null,\n-                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n-                'province' => $isMember ? $user->userInfo->province : null,\n-                'city' => $isMember ? $user->userInfo->city : null,\n-                'house_no' => $isMember ? $user->userInfo->house_no : null,\n-                'barangay' => $isMember ? $user->userInfo->barangay : null,\n-                'zone' => $isMember ? $user->userInfo->zone : null,\n-                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n-                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n-                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n-                'land_size' => $isMember ? $user->userInfo->land_size : null,\n-                'water_source' => $isMember ? $user->userInfo->water_source : null,\n-                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n-                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n-                'created_at' => $isMember ? $user->userInfo->created_at : null,\n-                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n-                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n-                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n-                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n-                'relationship' => $isMember ? $user->userInfo->relationship : null,\n-                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n-                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n-                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n-                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n-                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n-                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n-                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n-                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n-            ]\n-        ]);\n-    }\n-\n-    /**\n-     * Update the user's profile picture.\n-     */\n-    public function updatePicture(Request $request)\n-    {\n-        $request->validate([\n-            'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120',\n-        ]);\n-\n-        $user = $request->user();\n-\n-        if (!$user->userInfo) {\n             return response()->json([\n-                'success' => false,\n-                'message' => 'Only members can upload a profile picture.'\n-            ], 403);\n-        }\n-\n-        try {\n-            // Delete old image if exists\n-            if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n-                Storage::disk('public')->delete($user->userInfo->profile_img);\n-            }\n-\n-            // Store new image\n-            $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n-            \n-            // Update database\n-            $user->userInfo->update(['profile_img' => $path]);\n-\n-            return response()->json([\n                 'success' => true,\n                 'message' => 'Profile picture updated successfully.',\n                 'path' => $path,\n                 'url' => Storage::url($path),\n"
                }
            ],
            "date": 1763565836603,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers\\mobile;\n\nuse App\\Http\\Controllers\\Controller;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Storage;\n\nclass ProfileController extends Controller\n{\n    /**\n     * Show the authenticated user's profile information.\n     */\n    public function show(Request $request)\n    {\n        $user = $request->user();\n        \n        // Load user_info relationship\n        $user->load('userInfo');\n        \n        // Check if user is a REAL member (has QR code)\n        $isMember = $user->userInfo && $user->userInfo->qr_code;\n        \n        return response()->json([\n            'success' => true,\n            'user' => [\n                'id' => $user->id,\n                'email' => $user->email,\n                'role_id' => $user->role_id ?? null,\n                \n                // Basic info from users table (always available)\n                'first_name' => $user->first_name,\n                'middle_name' => $user->middle_name,\n                'last_name' => $user->last_name,\n                'suffix' => $user->suffix,\n                \n                // Membership info\n                'fname' => $isMember ? $user->userInfo->fname : null,\n                'mname' => $isMember ? $user->userInfo->mname : null,\n                'lname' => $isMember ? $user->userInfo->lname : null,\n                'member_suffix' => $isMember ? $user->userInfo->suffix : null,\n                'civil_status' => $isMember ? $user->userInfo->civil_status : null,\n                'gender' => $isMember ? $user->userInfo->gender : null,\n                'birthdate' => $isMember ? $user->userInfo->birthdate : null,\n                'province' => $isMember ? $user->userInfo->province : null,\n                'city' => $isMember ? $user->userInfo->city : null,\n                'house_no' => $isMember ? $user->userInfo->house_no : null,\n                'barangay' => $isMember ? $user->userInfo->barangay : null,\n                'zone' => $isMember ? $user->userInfo->zone : null,\n                'contact_no' => $isMember ? $user->userInfo->contact_no : null,\n                'farmer_type' => $isMember ? $user->userInfo->farmer_type : null,\n                'farm_location' => $isMember ? $user->userInfo->farm_location : null,\n                'land_size' => $isMember ? $user->userInfo->land_size : null,\n                'water_source' => $isMember ? $user->userInfo->water_source : null,\n                'qr_code' => $isMember ? $user->userInfo->qr_code : null,\n                'profile_img' => $isMember ? $user->userInfo->profile_img : null,\n                'created_at' => $isMember ? $user->userInfo->created_at : null,\n                'sc_fname' => $isMember ? $user->userInfo->sc_fname : null,\n                'sc_mname' => $isMember ? $user->userInfo->sc_mname : null,\n                'sc_lname' => $isMember ? $user->userInfo->sc_lname : null,\n                'sc_suffix' => $isMember ? $user->userInfo->sc_suffix : null,\n                'relationship' => $isMember ? $user->userInfo->relationship : null,\n                'sc_gender' => $isMember ? $user->userInfo->sc_gender : null,\n                'sc_province' => $isMember ? $user->userInfo->sc_province : null,\n                'sc_city' => $isMember ? $user->userInfo->sc_city : null,\n                'sc_house_no' => $isMember ? $user->userInfo->sc_house_no : null,\n                'sc_barangay' => $isMember ? $user->userInfo->sc_barangay : null,\n                'sc_zone' => $isMember ? $user->userInfo->sc_zone : null,\n                'sc_contact_no' => $isMember ? $user->userInfo->sc_contact_no : null,\n                'sc_email' => $isMember ? $user->userInfo->sc_email : null,\n            ]\n        ]);\n    }\n\n    /**\n     * Update the user's profile picture.\n     */\n    public function updatePicture(Request $request)\n    {\n        $request->validate([\n            'profile_picture' => 'required|image|mimes:jpeg,png,jpg,gif|max:5120',\n        ]);\n\n        $user = $request->user();\n\n        if (!$user->userInfo) {\n            return response()->json([\n                'success' => false,\n                'message' => 'Only members can upload a profile picture.'\n            ], 403);\n        }\n\n        try {\n            // Delete old image if exists\n            if ($user->userInfo->profile_img && Storage::disk('public')->exists($user->userInfo->profile_img)) {\n                Storage::disk('public')->delete($user->userInfo->profile_img);\n            }\n\n            // Store new image\n            $path = $request->file('profile_picture')->store('profile_pictures', 'public');\n            \n            // Update database\n            $user->userInfo->update(['profile_img' => $path]);\n\n            return response()->json([\n                'success' => true,\n                'message' => 'Profile picture updated successfully.',\n                'path' => $path,\n                'url' => Storage::url($path),\n            ]);\n        } catch (\\Exception $e) {\n            return response()->json([\n                'success' => false,\n                'message' => 'Upload failed: ' . $e->getMessage(),\n            ], 500);\n        }\n    }\n}\n"
        }
    ]
}