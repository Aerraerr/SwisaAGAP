{
    "sourceFile": "app/Http/Controllers/ReportMembershipController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1764248605398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764253053811,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,6 +32,19 @@\n \n         return view('swisa-admin.admin-reports.membership', compact(\n             'totalMembers', 'newMembers', 'activeMembers', 'members'\n         ));\n+\n+            // Get all sectors\n+    $sectors = Sector::orderBy('id')->get();\n+\n+    // Count members per sector\n+    $sectorCounts = $sectors->map(function ($sector) {\n+        return UserInfo::where('farmer_type', $sector->name)->count();\n+    });\n+\n+    return view('reports.membership', [\n+        'sectorLabels' => $sectors->pluck('name'),\n+        'sectorCounts' => $sectorCounts\n+    ]);\n     }\n }\n"
                },
                {
                    "date": 1764253197010,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,9 @@\n use Illuminate\\Http\\Request;\n use App\\Models\\UserInfo;\n use App\\Models\\Log;\n use Carbon\\Carbon;\n+use App\\Models\\Sector;\n \n class ReportMembershipController extends Controller\n {\n     public function index()\n"
                },
                {
                    "date": 1764253309943,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,10 +5,10 @@\n use Illuminate\\Http\\Request;\n use App\\Models\\UserInfo;\n use App\\Models\\Log;\n use Carbon\\Carbon;\n-use App\\Models\\Sector;\n \n+\n class ReportMembershipController extends Controller\n {\n     public function index()\n     {\n"
                },
                {
                    "date": 1764253411749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n use Illuminate\\Http\\Request;\n use App\\Models\\UserInfo;\n use App\\Models\\Log;\n use Carbon\\Carbon;\n-use App\\Models\\Sector;\n \n class ReportMembershipController extends Controller\n {\n     public function index()\n@@ -21,34 +20,18 @@\n                               ->count();\n \n         // Active members (users who logged in in last 30 days)\n         $activeMembersCount = Log::where('activity', 'Logged In')\n-                                 ->where('activity_timestamp', '>=', Carbon::now()->subDays(30))\n-                                 ->distinct('user_id')\n-                                 ->count('user_id');\n+                                ->where('activity_timestamp', '>=', Carbon::now()->subDays(30))\n+                                ->distinct('user_id')   // unique users\n+                                ->count('user_id');\n+        $activeMembers = $totalMembers ? round(($activeMembersCount / $totalMembers) * 100) : 0;\n \n-        $activeMembers = $totalMembers\n-            ? round(($activeMembersCount / $totalMembers) * 100)\n-            : 0;\n \n         // All members\n         $members = UserInfo::orderBy('created_at', 'desc')->get();\n \n-        // Load sectors\n-        $sectors = Sector::orderBy('id')->get();\n-\n-        // Count members per sector\n-        $sectorCounts = $sectors->map(function ($sector) {\n-            return UserInfo::where('farmer_type', $sector->name)->count();\n-        });\n-\n-        // Pass all to membership blade\n-        return view('swisa-admin.admin-reports.membership', [\n-            'totalMembers'  => $totalMembers,\n-            'newMembers'    => $newMembers,\n-            'activeMembers' => $activeMembers,\n-            'members'       => $members,\n-            'sectorLabels'  => $sectors->pluck('name'),\n-            'sectorCounts'  => $sectorCounts,\n-        ]);\n+        return view('swisa-admin.admin-reports.membership', compact(\n+            'totalMembers', 'newMembers', 'activeMembers', 'members'\n+        ));\n     }\n }\n"
                },
                {
                    "date": 1764253667121,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,54 @@\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use Illuminate\\Http\\Request;\n+use App\\Models\\UserInfo;\n+use App\\Models\\Log;\n+use Carbon\\Carbon;\n+use App\\Models\\Sector;\n+\n+class ReportMembershipController extends Controller\n+{\n+    public function index()\n+    {\n+        // Total members\n+        $totalMembers = UserInfo::count();\n+\n+        // New members this month\n+        $newMembers = UserInfo::whereMonth('created_at', Carbon::now()->month)\n+                              ->whereYear('created_at', Carbon::now()->year)\n+                              ->count();\n+\n+        // Active members (users who logged in in last 30 days)\n+        $activeMembersCount = Log::where('activity', 'Logged In')\n+                                 ->where('activity_timestamp', '>=', Carbon::now()->subDays(30))\n+                                 ->distinct('user_id')\n+                                 ->count('user_id');\n+\n+        $activeMembers = $totalMembers\n+            ? round(($activeMembersCount / $totalMembers) * 100)\n+            : 0;\n+\n+        // All members\n+        $members = UserInfo::orderBy('created_at', 'desc')->get();\n+\n+        // Load sectors\n+        $sectors = Sector::orderBy('id')->get();\n+\n+        // Count members per sector\n+        $sectorCounts = $sectors->map(function ($sector) {\n+            return UserInfo::where('farmer_type', $sector->name)->count();\n+        });\n+\n+        // Pass all to membership blade\n+        return view('swisa-admin.admin-reports.membership', [\n+            'totalMembers'  => $totalMembers,\n+            'newMembers'    => $newMembers,\n+            'activeMembers' => $activeMembers,\n+            'members'       => $members,\n+            'sectorLabels'  => $sectors->pluck('name'),\n+            'sectorCounts'  => $sectorCounts,\n+        ]);\n+    }\n+}\n"
                }
            ],
            "date": 1764248605398,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse App\\Models\\UserInfo;\nuse App\\Models\\Log;\nuse Carbon\\Carbon;\n\nclass ReportMembershipController extends Controller\n{\n    public function index()\n    {\n        // Total members\n        $totalMembers = UserInfo::count();\n\n        // New members this month\n        $newMembers = UserInfo::whereMonth('created_at', Carbon::now()->month)\n                              ->whereYear('created_at', Carbon::now()->year)\n                              ->count();\n\n        // Active members (users who logged in in last 30 days)\n        $activeMembersCount = Log::where('activity', 'Logged In')\n                                ->where('activity_timestamp', '>=', Carbon::now()->subDays(30))\n                                ->distinct('user_id')   // unique users\n                                ->count('user_id');\n        $activeMembers = $totalMembers ? round(($activeMembersCount / $totalMembers) * 100) : 0;\n\n\n        // All members\n        $members = UserInfo::orderBy('created_at', 'desc')->get();\n\n        return view('swisa-admin.admin-reports.membership', compact(\n            'totalMembers', 'newMembers', 'activeMembers', 'members'\n        ));\n    }\n}\n"
        }
    ]
}