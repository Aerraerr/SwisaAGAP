{
    "sourceFile": "app/Http/Controllers/LogController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1763781199659,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764087062908,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,37 @@\n+<?php\n+\n+namespace App\\Http\\Controllers\\mobile;\n+\n+use App\\Http\\Controllers\\Controller;\n+use Illuminate\\Http\\Request;\n+use App\\Models\\Log;\n+use Illuminate\\Support\\Facades\\Auth;\n+\n+class LogController extends Controller\n+{\n+    /**\n+     * Store a login activity\n+     */\n+    public function storeLoginLog(Request $request)\n+    {\n+        // Optional: get user from request or Auth\n+        $user = Auth::user(); // If using sanctum/jwt auth\n+\n+        $log = Log::create([\n+            'user_id' => $user ? $user->id : null,\n+            'user_name' => $user ? $user->first_name . ' ' . $user->last_name : $request->email ?? 'Unknown',\n+            'role' => $user ? $user->role : 'Guest',\n+            'activity' => 'Login attempt',\n+            'ip_address' => $request->ip(),\n+            'status' => $request->status ?? 'success', // success or failed\n+            'activity_timestamp' => now(),\n+            'details' => $request->details ?? null,\n+        ]);\n+\n+        return response()->json([\n+            'success' => true,\n+            'message' => 'Login logged successfully',\n+            'log' => $log,\n+        ]);\n+    }\n+}\n"
                },
                {
                    "date": 1764087854558,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,37 @@\n+<?php\n+\n+namespace App\\Http\\Controllers\\mobile;\n+\n+use App\\Http\\Controllers\\Controller;\n+use Illuminate\\Http\\Request;\n+use App\\Models\\Log;\n+use Illuminate\\Support\\Facades\\Auth;\n+\n+class LogController extends Controller\n+{\n+    /**\n+     * Store a login activity\n+     */\n+    public function storeLoginLog(Request $request)\n+    {\n+        // Optional: get user from request or Auth\n+        $user = Auth::user(); // If using sanctum/jwt auth\n+\n+        $log = Log::create([\n+            'user_id' => $user ? $user->id : null,\n+            'user_name' => $user ? $user->first_name . ' ' . $user->last_name : $request->email ?? 'Unknown',\n+            'role' => $user ? $user->role : 'Guest',\n+            'activity' => 'Login attempt',\n+            'ip_address' => $request->ip(),\n+            'status' => $request->status ?? 'success', // success or failed\n+            'activity_timestamp' => now(),\n+            'details' => $request->details ?? null,\n+        ]);\n+\n+        return response()->json([\n+            'success' => true,\n+            'message' => 'Login logged successfully',\n+            'log' => $log,\n+        ]);\n+    }\n+}\n"
                },
                {
                    "date": 1764088265441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,86 +1,13 @@\n <?php\n \n-namespace App\\Http\\Controllers\\mobile;\n+namespace App\\Http\\Controllers;\n \n-use App\\Http\\Controllers\\Controller;\n use Illuminate\\Http\\Request;\n-use App\\Models\\Log;\n-use Illuminate\\Support\\Facades\\Auth;\n+use App\\Models\\Log; // make sure you have a Log model\n \n class LogController extends Controller\n {\n-    /**\n-     * Store a login activity\n-     */\n-    public function storeLoginLog(Request $request)\n-    {\n-        // Optional: get user from request or Auth\n-        $user = Auth::user(); // If using sanctum/jwt auth\n-\n-        $log = Log::create([\n-            'user_id' => $user ? $user->id : null,\n-            'user_name' => $user ? $user->first_name . ' ' . $user->last_name : $request->email ?? 'Unknown',\n-            'role' => $user ? $user->role : 'Guest',\n-            'activity' => 'Login attempt',\n-            'ip_address' => $request->ip(),\n-            'status' => $request->status ?? 'success', // success or failed\n-            'activity_timestamp' => now(),\n-            'details' => $request->details ?? null,\n-        ]);\n-\n-        return response()->json([\n-            'success' => true,\n-            'message' => 'Login logged successfully',\n-            'log' => $log,\n-        ]);\n-    }\n-}\n-<?php\n-\n-namespace App\\Http\\Controllers\\mobile;\n-\n-use App\\Http\\Controllers\\Controller;\n-use Illuminate\\Http\\Request;\n-use App\\Models\\Log;\n-use Illuminate\\Support\\Facades\\Auth;\n-\n-class LogController extends Controller\n-{\n-    /**\n-     * Store a login activity\n-     */\n-    public function storeLoginLog(Request $request)\n-    {\n-        // Optional: get user from request or Auth\n-        $user = Auth::user(); // If using sanctum/jwt auth\n-\n-        $log = Log::create([\n-            'user_id' => $user ? $user->id : null,\n-            'user_name' => $user ? $user->first_name . ' ' . $user->last_name : $request->email ?? 'Unknown',\n-            'role' => $user ? $user->role : 'Guest',\n-            'activity' => 'Login attempt',\n-            'ip_address' => $request->ip(),\n-            'status' => $request->status ?? 'success', // success or failed\n-            'activity_timestamp' => now(),\n-            'details' => $request->details ?? null,\n-        ]);\n-\n-        return response()->json([\n-            'success' => true,\n-            'message' => 'Login logged successfully',\n-            'log' => $log,\n-        ]);\n-    }\n-}\n-<?php\n-\n-namespace App\\Http\\Controllers;\n-\n-use Illuminate\\Http\\Request;\n-use App\\Models\\Log;\n-class LogController extends Controller\n-{\n     public function index()\n     {\n         // Fetch latest logs with pagination\n         $logs = Log::latest('activity_timestamp')->paginate(10);\n"
                },
                {
                    "date": 1764090157658,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n {\n     public function index()\n     {\n         // Fetch latest logs with pagination\n-        $logs = Log::latest('activity_timestamp')->paginate(10);\n+        $logs = Log::latest('activity_timestamp')->paginate(20);\n \n         // Send the logs to your view\n         return view('swisa-admin.logs', compact('logs'));\n     }\n"
                },
                {
                    "date": 1765121113248,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,20 +6,64 @@\n use App\\Models\\Log; // make sure you have a Log model\n \n class LogController extends Controller\n {\n-    public function index()\n-    {\n-        // Fetch latest logs with pagination\n-        $logs = Log::latest('activity_timestamp')->paginate(20);\n+public function index()\n+{\n+    // Fetch main system logs\n+    $systemLogs = \\App\\Models\\Log::select(\n+        'id',\n+        'user_id',\n+        'user_name',\n+        'activity',\n+        'status',\n+        'role',\n+        'details',\n+        'ip_address',\n+        'activity_timestamp',\n+        'created_at'\n+    )\n+    ->latest('activity_timestamp')\n+    ->get();\n \n-        // Send the logs to your view\n-        return view('swisa-admin.logs', compact('logs'));\n-    }\n-    public function getRecentLogs()\n-    {\n-        // Get the 5 most recent logs\n-        $recentLogs = \\App\\Models\\Log::latest('activity_timestamp')->take(5)->get();\n+    // Fetch Activity History logs (from members)\n+    $historyLogs = \\App\\Models\\ActivityHistory::with('user')\n+        ->select(\n+            'id',\n+            'user_id',\n+            \\DB::raw(\"'' as role\"),\n+            \\DB::raw(\"'' as status\"),\n+            \\DB::raw(\"'' as ip_address\"),\n+            \\DB::raw(\"'' as details\"),\n+            'type as activity',\n+            'message as user_name',\n+            'created_at',\n+            \\DB::raw(\"created_at as activity_timestamp\")\n+        )\n+        ->latest('created_at')\n+        ->get();\n \n-        return view('charts.recent-activity', compact('recentLogs'));\n-    }\n+    // MERGE BOTH COLLECTIONS\n+    $mergedLogs = $systemLogs->concat($historyLogs);\n+\n+    // SORT BY DATE DESC\n+    $sortedLogs = $mergedLogs->sortByDesc(function ($log) {\n+        return $log->activity_timestamp ?? $log->created_at;\n+    });\n+\n+    // Paginate manually (because we merged 2 collections)\n+    $perPage = 20;\n+    $currentPage = request()->get('page', 1);\n+    $pagedLogs = new \\Illuminate\\Pagination\\LengthAwarePaginator(\n+        $sortedLogs->slice(($currentPage - 1) * $perPage, $perPage),\n+        $sortedLogs->count(),\n+        $perPage,\n+        $currentPage,\n+        ['path' => request()->url(), 'query' => request()->query()]\n+    );\n+\n+    return view('swisa-admin.logs', [\n+        'logs' => $pagedLogs\n+    ]);\n }\n+\n+}\n"
                },
                {
                    "date": 1765122174313,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,68 +2,73 @@\n \n namespace App\\Http\\Controllers;\n \n use Illuminate\\Http\\Request;\n-use App\\Models\\Log; // make sure you have a Log model\n+use App\\Models\\Log;\n+use App\\Models\\ActivityHistory;\n+use App\\Models\\User;\n \n class LogController extends Controller\n {\n-public function index()\n-{\n-    // Fetch main system logs\n-    $systemLogs = \\App\\Models\\Log::select(\n-        'id',\n-        'user_id',\n-        'user_name',\n-        'activity',\n-        'status',\n-        'role',\n-        'details',\n-        'ip_address',\n-        'activity_timestamp',\n-        'created_at'\n-    )\n-    ->latest('activity_timestamp')\n-    ->get();\n-\n-    // Fetch Activity History logs (from members)\n-    $historyLogs = \\App\\Models\\ActivityHistory::with('user')\n-        ->select(\n+    public function index()\n+    {\n+        // Fetch main system logs\n+        $systemLogs = Log::select(\n             'id',\n             'user_id',\n-            \\DB::raw(\"'' as role\"),\n-            \\DB::raw(\"'' as status\"),\n-            \\DB::raw(\"'' as ip_address\"),\n-            \\DB::raw(\"'' as details\"),\n-            'type as activity',\n-            'message as user_name',\n-            'created_at',\n-            \\DB::raw(\"created_at as activity_timestamp\")\n+            'user_name',\n+            'activity',\n+            'status',\n+            'role',\n+            'details',\n+            'ip_address',\n+            'activity_timestamp',\n+            'created_at'\n         )\n-        ->latest('created_at')\n+        ->latest('activity_timestamp')\n         ->get();\n \n-    // MERGE BOTH COLLECTIONS\n-    $mergedLogs = $systemLogs->concat($historyLogs);\n+        // Fetch Activity History logs (from members) with actual user name\n+        $historyLogs = ActivityHistory::with('user')\n+            ->select(\n+                'id',\n+                'user_id',\n+                \\DB::raw(\"'' as role\"),\n+                \\DB::raw(\"'' as status\"),\n+                \\DB::raw(\"'' as ip_address\"),\n+                \\DB::raw(\"'' as details\"),\n+                'type as activity',\n+                'user_id', // keep user_id\n+                'created_at',\n+                \\DB::raw(\"created_at as activity_timestamp\")\n+            )\n+            ->latest('created_at')\n+            ->get()\n+            ->map(function($log){\n+                $log->user_name = optional($log->user)->name ?? 'Unknown User';\n+                return $log;\n+            });\n \n-    // SORT BY DATE DESC\n-    $sortedLogs = $mergedLogs->sortByDesc(function ($log) {\n-        return $log->activity_timestamp ?? $log->created_at;\n-    });\n+        // Merge logs\n+        $mergedLogs = $systemLogs->concat($historyLogs);\n \n-    // Paginate manually (because we merged 2 collections)\n-    $perPage = 20;\n-    $currentPage = request()->get('page', 1);\n-    $pagedLogs = new \\Illuminate\\Pagination\\LengthAwarePaginator(\n-        $sortedLogs->slice(($currentPage - 1) * $perPage, $perPage),\n-        $sortedLogs->count(),\n-        $perPage,\n-        $currentPage,\n-        ['path' => request()->url(), 'query' => request()->query()]\n-    );\n+        // Sort by timestamp\n+        $sortedLogs = $mergedLogs->sortByDesc(function ($log) {\n+            return $log->activity_timestamp ?? $log->created_at;\n+        });\n \n-    return view('swisa-admin.logs', [\n-        'logs' => $pagedLogs\n-    ]);\n-}\n+        // Paginate manually\n+        $perPage = 20;\n+        $currentPage = request()->get('page', 1);\n+        $pagedLogs = new \\Illuminate\\Pagination\\LengthAwarePaginator(\n+            $sortedLogs->slice(($currentPage - 1) * $perPage, $perPage),\n+            $sortedLogs->count(),\n+            $perPage,\n+            $currentPage,\n+            ['path' => request()->url(), 'query' => request()->query()]\n+        );\n \n+        return view('swisa-admin.logs', [\n+            'logs' => $pagedLogs\n+        ]);\n+    }\n }\n"
                },
                {
                    "date": 1765122204393,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,9 +14,9 @@\n         // Fetch main system logs\n         $systemLogs = Log::select(\n             'id',\n             'user_id',\n-            'user_name',\n+            'name',\n             'activity',\n             'status',\n             'role',\n             'details',\n"
                },
                {
                    "date": 1765122209907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n \n use Illuminate\\Http\\Request;\n use App\\Models\\Log;\n use App\\Models\\ActivityHistory;\n-use App\\Models\\User;\n+use App\\Models\\UserInfo;\n \n class LogController extends Controller\n {\n     public function index()\n"
                },
                {
                    "date": 1765122223600,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n \n use Illuminate\\Http\\Request;\n use App\\Models\\Log;\n use App\\Models\\ActivityHistory;\n-use App\\Models\\UserInfo;\n+use App\\Models\\User;\n \n class LogController extends Controller\n {\n     public function index()\n"
                },
                {
                    "date": 1765122358252,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n \n use Illuminate\\Http\\Request;\n use App\\Models\\Log;\n use App\\Models\\ActivityHistory;\n-use App\\Models\\User;\n+use App\\Models\\UserInfo;\n \n class LogController extends Controller\n {\n     public function index()\n@@ -14,9 +14,9 @@\n         // Fetch main system logs\n         $systemLogs = Log::select(\n             'id',\n             'user_id',\n-            'name',\n+            'user_name',\n             'activity',\n             'status',\n             'role',\n             'details',\n@@ -26,26 +26,25 @@\n         )\n         ->latest('activity_timestamp')\n         ->get();\n \n-        // Fetch Activity History logs (from members) with actual user name\n-        $historyLogs = ActivityHistory::with('user')\n+        // Fetch Activity History logs (from members) with actual user name from UserInfo\n+        $historyLogs = ActivityHistory::with('user.user_info') // load related user_info\n             ->select(\n                 'id',\n                 'user_id',\n                 \\DB::raw(\"'' as role\"),\n                 \\DB::raw(\"'' as status\"),\n                 \\DB::raw(\"'' as ip_address\"),\n                 \\DB::raw(\"'' as details\"),\n                 'type as activity',\n-                'user_id', // keep user_id\n                 'created_at',\n                 \\DB::raw(\"created_at as activity_timestamp\")\n             )\n             ->latest('created_at')\n             ->get()\n             ->map(function($log){\n-                $log->user_name = optional($log->user)->name ?? 'Unknown User';\n+                $log->user_name = optional($log->user->user_info)->name ?? 'Unknown User';\n                 return $log;\n             });\n \n         // Merge logs\n"
                },
                {
                    "date": 1765124214612,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,27 +27,28 @@\n         ->latest('activity_timestamp')\n         ->get();\n \n         // Fetch Activity History logs (from members) with actual user name from UserInfo\n-        $historyLogs = ActivityHistory::with('user.user_info') // load related user_info\n-            ->select(\n-                'id',\n-                'user_id',\n-                \\DB::raw(\"'' as role\"),\n-                \\DB::raw(\"'' as status\"),\n-                \\DB::raw(\"'' as ip_address\"),\n-                \\DB::raw(\"'' as details\"),\n-                'type as activity',\n-                'created_at',\n-                \\DB::raw(\"created_at as activity_timestamp\")\n-            )\n-            ->latest('created_at')\n-            ->get()\n-            ->map(function($log){\n-                $log->user_name = optional($log->user->user_info)->name ?? 'Unknown User';\n-                return $log;\n-            });\n+$historyLogs = ActivityHistory::with('user.user_info')\n+    ->select(\n+        'id',\n+        'user_id',\n+        \\DB::raw(\"'' as role\"),\n+        \\DB::raw(\"'' as status\"),\n+        \\DB::raw(\"'' as ip_address\"),\n+        \\DB::raw(\"'' as details\"),\n+        'type as activity',\n+        'created_at',\n+        \\DB::raw(\"created_at as activity_timestamp\")\n+    )\n+    ->latest('created_at')\n+    ->get()\n+    ->map(function($log){\n+        $log->user_name = optional($log->user->user_info)->name ?? 'Unknown User';\n+        return $log;\n+    });\n \n+\n         // Merge logs\n         $mergedLogs = $systemLogs->concat($historyLogs);\n \n         // Sort by timestamp\n"
                }
            ],
            "date": 1763781199659,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Log;\nclass LogController extends Controller\n{\n    public function index()\n    {\n        // Fetch latest logs with pagination\n        $logs = Log::latest('activity_timestamp')->paginate(10);\n\n        // Send the logs to your view\n        return view('swisa-admin.logs', compact('logs'));\n    }\n    public function getRecentLogs()\n    {\n        // Get the 5 most recent logs\n        $recentLogs = \\App\\Models\\Log::latest('activity_timestamp')->take(5)->get();\n\n        return view('charts.recent-activity', compact('recentLogs'));\n    }\n}\n"
        }
    ]
}