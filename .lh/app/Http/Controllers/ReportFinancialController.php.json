{
    "sourceFile": "app/Http/Controllers/ReportFinancialController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 72,
            "patches": [
                {
                    "date": 1764318797199,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764318889834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,19 +7,22 @@\n use App\\Models\\ReportFinancial;\n \n class ReportFinancialController extends Controller\n {\n-    public function index()\n-    {\n-        // Calculate Total Grants Released\n-        $totalGrantsReleased = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 2) // assuming 2 = released\n-            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n+public function index()\n+{\n+    // Calculate Total Grants Released\n+    $totalGrantsReleased = \\DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 2) // released applications\n+        ->sum(\\DB::raw('a.total_quantity * g.amount_per_quantity'));\n \n-        // Format to PHP number format with 2 decimals\n-        $formattedTotal = number_format($totalGrantsReleased, 2);\n+    // Format to currency style\n+    $formattedTotal = number_format($totalGrantsReleased, 2);\n \n-        // Pass to the view\n-        return view('swisa-admin.admin-reports.financial', compact('formattedTotal'));\n-    }\n+    // Pass variable to view\n+    return view('swisa-admin.admin-reports.financial', [\n+        'formattedTotal' => $formattedTotal\n+    ]);\n }\n+\n+}\n"
                },
                {
                    "date": 1764319191726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,5 +24,16 @@\n         'formattedTotal' => $formattedTotal\n     ]);\n }\n \n+\n+    public function totalGrantsReleased()\n+    {\n+        // Sum of total_quantity * amount_per_quantity for released applications\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 2) // assuming 2 = released\n+            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n+\n+        return $total; // returns as float\n+    }\n }\n"
                },
                {
                    "date": 1764319242068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,24 +9,13 @@\n class ReportFinancialController extends Controller\n {\n public function index()\n {\n-    // Calculate Total Grants Released\n-    $totalGrantsReleased = \\DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 2) // released applications\n-        ->sum(\\DB::raw('a.total_quantity * g.amount_per_quantity'));\n+$totalGrants = app('App\\Http\\Controllers\\ReportFinancialController')\n+                    ->totalGrantsReleased();\n \n-    // Format to currency style\n-    $formattedTotal = number_format($totalGrantsReleased, 2);\n \n-    // Pass variable to view\n-    return view('swisa-admin.admin-reports.financial', [\n-        'formattedTotal' => $formattedTotal\n-    ]);\n-}\n \n-\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764319258842,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,13 +9,12 @@\n class ReportFinancialController extends Controller\n {\n public function index()\n {\n-$totalGrants = app('App\\Http\\Controllers\\ReportFinancialController')\n-                    ->totalGrantsReleased();\n+    // Calculate Total Grants Released\n+}\n \n \n-\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764319333020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n             ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 2) // assuming 2 = released\n+            ->where('a.status_id', 4) // assuming 2 = released\n             ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n \n         return $total; // returns as float\n     }\n"
                },
                {
                    "date": 1764319385434,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n             ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 4) // assuming 2 = released\n+            ->where('a.status_id', 5) // assuming 2 = released\n             ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n \n         return $total; // returns as float\n     }\n"
                },
                {
                    "date": 1764319439587,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n             ->join('grants as g', 'a.grant_id', '=', 'g.id')\n             ->where('a.status_id', 5) // assuming 2 = released\n-            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n \n         return $total; // returns as float\n     }\n }\n"
                },
                {
                    "date": 1764320159319,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,18 @@\n     // Calculate Total Grants Released\n }\n \n \n+    public function overAllBudget()\n+    {\n+        // Sum of total_quantity * amount_per_quantity for released applications\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 5) // assuming 2 = released\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+\n+        return $total; // returns as float\n+    }\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764320572148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,18 +13,17 @@\n     // Calculate Total Grants Released\n }\n \n \n-    public function overAllBudget()\n-    {\n-        // Sum of total_quantity * amount_per_quantity for released applications\n-        $total = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 5) // assuming 2 = released\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+public function overAllBudget()\n+{\n+    // Sum of total stock * amount per unit for all grants\n+    $total = \\DB::table('grants')\n+        ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n \n-        return $total; // returns as float\n-    }\n+    return $total; // returns as float\n+}\n+\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764320665905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,13 +15,15 @@\n \n \n public function overAllBudget()\n {\n-    // Sum of total stock * amount per unit for all grants\n-    $total = \\DB::table('grants')\n-        ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n+$allGrants = \\DB::table('grants')->get();\n+dd($allGrants);\n \n-    return $total; // returns as float\n+$total = \\DB::table('grants')\n+    ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n+dd($total);\n+\n }\n \n     public function totalGrantsReleased()\n     {\n"
                },
                {
                    "date": 1764320820205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,23 +9,17 @@\n class ReportFinancialController extends Controller\n {\n public function index()\n {\n-    // Calculate Total Grants Released\n-}\n+    $totalBudget = $this->overAllBudget(); // call the separate function\n \n+    // Format it for display (optional)\n+    $formattedTotalBudget = number_format($totalBudget, 2);\n \n-public function overAllBudget()\n-{\n-$allGrants = \\DB::table('grants')->get();\n-dd($allGrants);\n+    return view('swisa-admin.admin-reports.financial', compact('formattedTotalBudget'));\n+}\n \n-$total = \\DB::table('grants')\n-    ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n-dd($total);\n \n-}\n-\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764320883329,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,17 +9,23 @@\n class ReportFinancialController extends Controller\n {\n public function index()\n {\n-    $totalBudget = $this->overAllBudget(); // call the separate function\n+    // Calculate Total Grants Released\n+}\n \n-    // Format it for display (optional)\n-    $formattedTotalBudget = number_format($totalBudget, 2);\n \n-    return view('swisa-admin.admin-reports.financial', compact('formattedTotalBudget'));\n+public function overAllBudget()\n+{\n+$allGrants = \\DB::table('grants')->get();\n+dd($allGrants);\n+\n+$total = \\DB::table('grants')\n+    ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n+dd($total);\n+\n }\n \n-\n     public function totalGrantsReleased()\n     {\n         // Sum of total_quantity * amount_per_quantity for released applications\n         $total = DB::table('applications as a')\n"
                },
                {
                    "date": 1764321647453,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,32 +7,34 @@\n use App\\Models\\ReportFinancial;\n \n class ReportFinancialController extends Controller\n {\n-public function index()\n-{\n-    // Calculate Total Grants Released\n-}\n+    // Total Grants Released: funds actually released to members\n+    public function totalGrantsReleased()\n+    {\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 5) // 5 = released\n+            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity')); \n+            // Multiply by 'a.total_quantity' because that's what was actually released\n \n+        return $total;\n+    }\n \n-public function overAllBudget()\n-{\n-$allGrants = \\DB::table('grants')->get();\n-dd($allGrants);\n+    // Overall Budget: sum of all grants available\n+    public function overAllBudget()\n+    {\n+        $total = DB::table('grants')\n+            ->sum(DB::raw('total_quantity * amount_per_quantity'));\n \n-$total = \\DB::table('grants')\n-    ->sum(\\DB::raw('total_quantity * amount_per_quantity'));\n-dd($total);\n+        return $total;\n+    }\n \n-}\n-\n-    public function totalGrantsReleased()\n+    // Optional: Budget Utilization (example)\n+    public function budgetUtilization()\n     {\n-        // Sum of total_quantity * amount_per_quantity for released applications\n-        $total = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 5) // assuming 2 = released\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+        $released = $this->totalGrantsReleased();\n+        $budget = $this->overAllBudget();\n \n-        return $total; // returns as float\n+        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n     }\n }\n"
                },
                {
                    "date": 1764321700463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,9 +13,9 @@\n     {\n         $total = DB::table('applications as a')\n             ->join('grants as g', 'a.grant_id', '=', 'g.id')\n             ->where('a.status_id', 5) // 5 = released\n-            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity')); \n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity')); \n             // Multiply by 'a.total_quantity' because that's what was actually released\n \n         return $total;\n     }\n"
                },
                {
                    "date": 1764322309496,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,16 +20,18 @@\n         return $total;\n     }\n \n     // Overall Budget: sum of all grants available\n-    public function overAllBudget()\n-    {\n-        $total = DB::table('grants')\n-            ->sum(DB::raw('total_quantity * amount_per_quantity'));\n+public function overAllBudget()\n+{\n+    $total = DB::table('grants as g')\n+        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n \n-        return $total;\n-    }\n+    return $total;\n+}\n \n+\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764322513899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,10 +24,14 @@\n public function overAllBudget()\n {\n     $total = DB::table('grants as g')\n         ->join('applications as a', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n \n+    $total2 = DB::table('grants as g')\n+        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n+\n     return $total;\n }\n \n \n"
                },
                {
                    "date": 1764322870087,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,20 +22,25 @@\n \n     // Overall Budget: sum of all grants available\n public function overAllBudget()\n {\n+    // Total potential budget for all grants (total stock Ã— amount per unit)\n     $total = DB::table('grants as g')\n-        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n \n-    $total2 = DB::table('grants as g')\n-        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n+    // Total based on applications (each request counts as 1 Ã— unit_per_request Ã— amount_per_quantity)\n+    $total2 = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-    return $total;\n+    return [\n+        'total_grants' => $total,\n+        'total_requested' => $total2\n+    ];\n }\n \n \n+\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764322880242,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,25 +22,20 @@\n \n     // Overall Budget: sum of all grants available\n public function overAllBudget()\n {\n-    // Total potential budget for all grants (total stock Ã— amount per unit)\n     $total = DB::table('grants as g')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n \n-    // Total based on applications (each request counts as 1 Ã— unit_per_request Ã— amount_per_quantity)\n-    $total2 = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+    $total2 = DB::table('grants as g')\n+        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.total_quantity  g.amount_per_quantity '));\n \n-    return [\n-        'total_grants' => $total,\n-        'total_requested' => $total2\n-    ];\n+    return $total;\n }\n \n \n-\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764322910916,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,20 +22,25 @@\n \n     // Overall Budget: sum of all grants available\n public function overAllBudget()\n {\n+    // Total potential budget for all grants\n     $total = DB::table('grants as g')\n-        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity '));\n+        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n \n-    $total2 = DB::table('grants as g')\n-        ->join('applications as a', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.total_quantity  g.amount_per_quantity '));\n+    // Total requested based on applications\n+    $total2 = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-    return $total;\n+    // Combined total\n+    $combinedTotal = $total + $total2;\n+\n+    return $combinedTotal; // returns as float\n }\n \n \n+\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764324169415,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,30 +14,26 @@\n         $total = DB::table('applications as a')\n             ->join('grants as g', 'a.grant_id', '=', 'g.id')\n             ->where('a.status_id', 5) // 5 = released\n             ->sum(DB::raw('g.total_quantity * g.amount_per_quantity')); \n-            // Multiply by 'a.total_quantity' because that's what was actually released\n \n+\n         return $total;\n     }\n \n-    // Overall Budget: sum of all grants available\n-public function overAllBudget()\n-{\n-    // Total potential budget for all grants\n-    $total = DB::table('grants as g')\n-        ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+    public function overAllBudget()\n+    {\n \n-    // Total requested based on applications\n-    $total2 = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+        $total = DB::table('grants as g')\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n \n-    // Combined total\n-    $combinedTotal = $total + $total2;\n+        $total2 = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+        $combinedTotal = $total + $total2;\n \n-    return $combinedTotal; // returns as float\n-}\n+        return $combinedTotal;\n+    }\n \n \n \n     // Optional: Budget Utilization (example)\n"
                },
                {
                    "date": 1764324383654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,20 +7,10 @@\n use App\\Models\\ReportFinancial;\n \n class ReportFinancialController extends Controller\n {\n-    // Total Grants Released: funds actually released to members\n-    public function totalGrantsReleased()\n-    {\n-        $total = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 5) // 5 = released\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity')); \n \n \n-        return $total;\n-    }\n-\n     public function overAllBudget()\n     {\n \n         $total = DB::table('grants as g')\n@@ -32,11 +22,22 @@\n         $combinedTotal = $total + $total2;\n \n         return $combinedTotal;\n     }\n+    // Total Grants Released: funds actually released to members\n+    public function totalGrantsReleased()\n+    {\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 5) // 5 = released\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity')); \n \n \n+        return $total;\n+    }\n \n+\n+\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764324430250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,22 +22,21 @@\n         $combinedTotal = $total + $total2;\n \n         return $combinedTotal;\n     }\n-    // Total Grants Released: funds actually released to members\n-    public function totalGrantsReleased()\n-    {\n-        $total = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->where('a.status_id', 5) // 5 = released\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity')); \n+public function totalGrantsReleased()\n+{\n+    // Sum of released grants based on actual applications\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 5) // 5 = released\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n+    return $total; // returns as float\n+}\n \n-        return $total;\n-    }\n \n \n-\n     // Optional: Budget Utilization (example)\n     public function budgetUtilization()\n     {\n         $released = $this->totalGrantsReleased();\n"
                },
                {
                    "date": 1764324722595,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,5 +43,20 @@\n         $budget = $this->overAllBudget();\n \n         return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n     }\n+\n+    public function totalGrantsReleased()\n+{\n+    // Sum of released grants based on actual applications\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 5) // 5 = released\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+\n+    return $total; // returns as float\n }\n+\n+\n+\n+    pendingDisbursements\n+}\n"
                },
                {
                    "date": 1764324744627,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,62 @@\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use Illuminate\\Http\\Request;\n+use Illuminate\\Support\\Facades\\DB;\n+use App\\Models\\ReportFinancial;\n+\n+class ReportFinancialController extends Controller\n+{\n+\n+\n+    public function overAllBudget()\n+    {\n+\n+        $total = DB::table('grants as g')\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+\n+        $total2 = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+        $combinedTotal = $total + $total2;\n+\n+        return $combinedTotal;\n+    }\n+public function totalGrantsReleased()\n+{\n+    // Sum of released grants based on actual applications\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 5) // 5 = released\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+\n+    return $total; // returns as float\n+}\n+\n+\n+\n+    // Optional: Budget Utilization (example)\n+    public function budgetUtilization()\n+    {\n+        $released = $this->totalGrantsReleased();\n+        $budget = $this->overAllBudget();\n+\n+        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n+    }\n+\n+    public function pendingDisbursements()\n+{\n+    // Sum of released grants based on actual applications\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 3) // 5 = released\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+\n+    return $total; // returns as float\n+}\n+\n+\n+\n+    \n+}\n"
                },
                {
                    "date": 1764324805938,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,81 +44,20 @@\n \n         return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n     }\n \n-    public function pendingDisbursements()\n+public function pendingDisbursements()\n {\n-    // Sum of released grants based on actual applications\n+    // Sum of all applications that are pending (status_id = 3)\n+    // Each request counts as 1, multiplied by the grant's unit_per_request and amount_per_quantity\n     $total = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 3) // 5 = released\n+        ->where('a.status_id', 3) // 3 = Pending\n         ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-    return $total; // returns as float\n+    return $total; // float\n }\n \n \n \n     \n }\n-<?php\n-\n-namespace App\\Http\\Controllers;\n-\n-use Illuminate\\Http\\Request;\n-use Illuminate\\Support\\Facades\\DB;\n-use App\\Models\\ReportFinancial;\n-\n-class ReportFinancialController extends Controller\n-{\n-\n-\n-    public function overAllBudget()\n-    {\n-\n-        $total = DB::table('grants as g')\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n-\n-        $total2 = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-        $combinedTotal = $total + $total2;\n-\n-        return $combinedTotal;\n-    }\n-public function totalGrantsReleased()\n-{\n-    // Sum of released grants based on actual applications\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 5) // 5 = released\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-\n-    return $total; // returns as float\n-}\n-\n-\n-\n-    // Optional: Budget Utilization (example)\n-    public function budgetUtilization()\n-    {\n-        $released = $this->totalGrantsReleased();\n-        $budget = $this->overAllBudget();\n-\n-        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n-    }\n-\n-    public function totalGrantsReleased()\n-{\n-    // Sum of released grants based on actual applications\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 5) // 5 = released\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-\n-    return $total; // returns as float\n-}\n-\n-\n-\n-    pendingDisbursements\n-}\n"
                },
                {
                    "date": 1764339961949,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,39 @@\n }\n \n \n \n+public function recentTransactions()\n+{\n+    // Fetch latest 10 financial-related transactions\n+    $transactions = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->select(\n+            DB::raw(\"'GRANT-\" . \"' || a.id as transaction_id\"),\n+            DB::raw(\"'Grant' as type\"),\n+            DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n+            'a.updated_at as date',\n+            'a.status_id'\n+        )\n+        ->orderBy('a.updated_at', 'desc')\n+        ->limit(10)\n+        ->get()\n+        ->map(function ($t) {\n+            return [\n+                'transaction_id' => 'TXN-' . str_pad($t->transaction_id, 6, '0', STR_PAD_LEFT),\n+                'type' => $t->type,\n+                'amount' => $t->amount,\n+                'date' => date('Y-m-d', strtotime($t->date)),\n+                'status' => match ($t->status_id) {\n+                    5 => 'Released',\n+                    3 => 'Pending',\n+                    default => 'Processed',\n+                },\n+            ];\n+        });\n+\n+    return $transactions;\n+}\n+\n+\n     \n }\n"
                },
                {
                    "date": 1764339970693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,10 +7,18 @@\n use App\\Models\\ReportFinancial;\n \n class ReportFinancialController extends Controller\n {\n+public function index()\n+{\n+    $transactions = $this->recentTransactions();\n \n+    return view('swisa-admin.admin-reports.financial', [\n+        'transactions' => $transactions\n+    ]);\n+}\n \n+\n     public function overAllBudget()\n     {\n \n         $total = DB::table('grants as g')\n"
                },
                {
                    "date": 1764340131330,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,18 +7,10 @@\n use App\\Models\\ReportFinancial;\n \n class ReportFinancialController extends Controller\n {\n-public function index()\n-{\n-    $transactions = $this->recentTransactions();\n \n-    return view('swisa-admin.admin-reports.financial', [\n-        'transactions' => $transactions\n-    ]);\n-}\n \n-\n     public function overAllBudget()\n     {\n \n         $total = DB::table('grants as g')\n"
                },
                {
                    "date": 1764340633020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,37 +60,50 @@\n \n \n public function recentTransactions()\n {\n-    // Fetch latest 10 financial-related transactions\n-    $transactions = DB::table('applications as a')\n+    $applicationTransactions = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n         ->select(\n-            DB::raw(\"'GRANT-\" . \"' || a.id as transaction_id\"),\n+            DB::raw(\"CONCAT('APP-', a.id) as transaction_id\"),\n             DB::raw(\"'Grant' as type\"),\n             DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n             'a.updated_at as date',\n             'a.status_id'\n-        )\n-        ->orderBy('a.updated_at', 'desc')\n+        );\n+    $grantTransactions = DB::table('grants as g')\n+        ->select(\n+            DB::raw(\"CONCAT('GRANT-', g.id) as transaction_id\"),\n+            DB::raw(\"'Grant Allocation' as type\"),\n+            DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n+            'g.created_at as date',\n+            DB::raw(\"NULL as status_id\")\n+        );\n+    $transactions = $applicationTransactions\n+        ->unionAll($grantTransactions)\n+        ->orderBy('date', 'desc')\n         ->limit(10)\n         ->get()\n         ->map(function ($t) {\n+            $status = match($t->status_id) {\n+                5 => 'Released',\n+                3 => 'Pending',\n+                default => 'Processed',\n+                NULL => 'N/A'\n+            };\n+\n             return [\n-                'transaction_id' => 'TXN-' . str_pad($t->transaction_id, 6, '0', STR_PAD_LEFT),\n+                'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n                 'date' => date('Y-m-d', strtotime($t->date)),\n-                'status' => match ($t->status_id) {\n-                    5 => 'Released',\n-                    3 => 'Pending',\n-                    default => 'Processed',\n-                },\n+                'status' => $status,\n             ];\n         });\n \n     return $transactions;\n }\n \n \n+\n     \n }\n"
                },
                {
                    "date": 1764340684128,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n             return [\n                 'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n-                'date' => date('Y-m-d', strtotime($t->date)),\n+                'date' => date('F Y', strtotime($t->date)),\n                 'status' => $status,\n             ];\n         });\n \n"
                },
                {
                    "date": 1764340696489,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n             return [\n                 'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n-                'date' => date('F Y', strtotime($t->date)),\n+                'date' => date('F D Y', strtotime($t->date)),\n                 'status' => $status,\n             ];\n         });\n \n"
                },
                {
                    "date": 1764340707530,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n             return [\n                 'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n-                'date' => date('F D Y', strtotime($t->date)),\n+                'date' => date('Y-m-d', strtotime($t->date)),\n                 'status' => $status,\n             ];\n         });\n \n"
                },
                {
                    "date": 1764340723230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n             return [\n                 'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n-                'date' => date('Y-m-d', strtotime($t->date)),\n+                'date' => date('F d Y', strtotime($t->date)),\n                 'status' => $status,\n             ];\n         });\n \n"
                },
                {
                    "date": 1764340731513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n             return [\n                 'transaction_id' => $t->transaction_id,\n                 'type' => $t->type,\n                 'amount' => $t->amount,\n-                'date' => date('F d Y', strtotime($t->date)),\n+                'date' => date('F d, Y', strtotime($t->date)),\n                 'status' => $status,\n             ];\n         });\n \n"
                },
                {
                    "date": 1764341150818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,9 +78,9 @@\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n         );\n     $transactions = $applicationTransactions\n-        ->unionAll($grantTransactions)\n+        ->unionAll($applicationTransactions)\n         ->orderBy('date', 'desc')\n         ->limit(10)\n         ->get()\n         ->map(function ($t) {\n"
                },
                {
                    "date": 1764341164536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,9 +78,9 @@\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n         );\n     $transactions = $applicationTransactions\n-        ->unionAll($applicationTransactions)\n+        ->unionAll($grantTransactions)\n         ->orderBy('date', 'desc')\n         ->limit(10)\n         ->get()\n         ->map(function ($t) {\n"
                },
                {
                    "date": 1764341190333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n         );\n     $transactions = $applicationTransactions\n         ->unionAll($grantTransactions)\n         ->orderBy('date', 'desc')\n-        ->limit(10)\n+        ->limit(100)\n         ->get()\n         ->map(function ($t) {\n             $status = match($t->status_id) {\n                 5 => 'Released',\n"
                },
                {
                    "date": 1764341203556,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n         );\n     $transactions = $applicationTransactions\n         ->unionAll($grantTransactions)\n         ->orderBy('date', 'desc')\n-        ->limit(100)\n+        ->limit(1000)\n         ->get()\n         ->map(function ($t) {\n             $status = match($t->status_id) {\n                 5 => 'Released',\n"
                },
                {
                    "date": 1764342253871,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -64,9 +64,9 @@\n     $applicationTransactions = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n         ->select(\n             DB::raw(\"CONCAT('APP-', a.id) as transaction_id\"),\n-            DB::raw(\"'Grant' as type\"),\n+            DB::raw(\"'Grant Request' as type\"),\n             DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n             'a.updated_at as date',\n             'a.status_id'\n         );\n"
                },
                {
                    "date": 1764342719410,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,31 +77,34 @@\n             DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n         );\n-    $transactions = $applicationTransactions\n-        ->unionAll($grantTransactions)\n-        ->orderBy('date', 'desc')\n-        ->limit(1000)\n-        ->get()\n-        ->map(function ($t) {\n-            $status = match($t->status_id) {\n-                5 => 'Released',\n-                3 => 'Pending',\n-                default => 'Processed',\n-                NULL => 'N/A'\n-            };\n+$transactions = $applicationTransactions\n+    ->unionAll($grantTransactions)\n+    ->orderBy('date', 'desc')\n+    ->limit(1000)\n+    ->get()\n+    ->map(function ($t) {\n \n-            return [\n-                'transaction_id' => $t->transaction_id,\n-                'type' => $t->type,\n-                'amount' => $t->amount,\n-                'date' => date('F d, Y', strtotime($t->date)),\n-                'status' => $status,\n-            ];\n-        });\n+        $status = (int) $t->status_id; // ðŸ”¥ force integer\n \n-    return $transactions;\n+        $statusText = match($status) {\n+            5 => 'Released',\n+            3 => 'Pending',\n+            default => 'Processed',\n+        };\n+\n+        return [\n+            'transaction_id' => $t->transaction_id,\n+            'type' => $t->type,\n+            'amount' => $t->amount,\n+            'date' => date('F d, Y', strtotime($t->date)),\n+            'status' => $statusText,\n+        ];\n+    });\n+\n+return $transactions;\n+\n }\n \n \n \n"
                },
                {
                    "date": 1764342736757,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,33 +77,33 @@\n             DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n         );\n-$transactions = $applicationTransactions\n-    ->unionAll($grantTransactions)\n-    ->orderBy('date', 'desc')\n-    ->limit(1000)\n-    ->get()\n-    ->map(function ($t) {\n+        $transactions = $applicationTransactions\n+            ->unionAll($grantTransactions)\n+            ->orderBy('date', 'desc')\n+            ->limit(1000)\n+            ->get()\n+            ->map(function ($t) {\n \n-        $status = (int) $t->status_id; // ðŸ”¥ force integer\n+                $status = (int) $t->status_id; // ðŸ”¥ force integer\n \n-        $statusText = match($status) {\n-            5 => 'Released',\n-            3 => 'Pending',\n-            default => 'Processed',\n-        };\n+                $statusText = match($status) {\n+                    5 => 'Released',\n+                    3 => 'Pending',\n+                    default => 'Processed',\n+                };\n \n-        return [\n-            'transaction_id' => $t->transaction_id,\n-            'type' => $t->type,\n-            'amount' => $t->amount,\n-            'date' => date('F d, Y', strtotime($t->date)),\n-            'status' => $statusText,\n-        ];\n-    });\n+                return [\n+                    'transaction_id' => $t->transaction_id,\n+                    'type' => $t->type,\n+                    'amount' => $t->amount,\n+                    'date' => date('F d, Y', strtotime($t->date)),\n+                    'status' => $statusText,\n+                ];\n+            });\n \n-return $transactions;\n+        return $transactions;\n \n }\n \n \n"
                },
                {
                    "date": 1764342904331,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,112 @@\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use Illuminate\\Http\\Request;\n+use Illuminate\\Support\\Facades\\DB;\n+use App\\Models\\ReportFinancial;\n+\n+class ReportFinancialController extends Controller\n+{\n+\n+\n+    public function overAllBudget()\n+    {\n+\n+        $total = DB::table('grants as g')\n+            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n+\n+        $total2 = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+        $combinedTotal = $total + $total2;\n+\n+        return $combinedTotal;\n+    }\n+public function totalGrantsReleased()\n+{\n+    // Sum of released grants based on actual applications\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 5) // 5 = released\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+\n+    return $total; // returns as float\n+}\n+\n+\n+\n+    // Optional: Budget Utilization (example)\n+    public function budgetUtilization()\n+    {\n+        $released = $this->totalGrantsReleased();\n+        $budget = $this->overAllBudget();\n+\n+        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n+    }\n+\n+public function pendingDisbursements()\n+{\n+    // Sum of all applications that are pending (status_id = 3)\n+    // Each request counts as 1, multiplied by the grant's unit_per_request and amount_per_quantity\n+    $total = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->where('a.status_id', 3) // 3 = Pending\n+        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+\n+    return $total; // float\n+}\n+\n+\n+\n+public function recentTransactions()\n+{\n+    $applicationTransactions = DB::table('applications as a')\n+        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+        ->select(\n+            DB::raw(\"CONCAT('APP-', a.id) as transaction_id\"),\n+            DB::raw(\"'Grant Request' as type\"),\n+            DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n+            'a.updated_at as date',\n+            'a.status_id'\n+        );\n+    $grantTransactions = DB::table('grants as g')\n+        ->select(\n+            DB::raw(\"CONCAT('GRANT-', g.id) as transaction_id\"),\n+            DB::raw(\"'Grant Allocation' as type\"),\n+            DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n+            'g.created_at as date',\n+            DB::raw(\"NULL as status_id\")\n+        );\n+        $transactions = $applicationTransactions\n+            ->unionAll($grantTransactions)\n+            ->orderBy('date', 'desc')\n+            ->limit(1000)\n+            ->get()\n+            ->map(function ($t) {\n+\n+                $status = (int) $t->status_id; \n+\n+                $statusText = match($status) {\n+                    5 => 'Completed',\n+                    3 => 'Pending',\n+                    default => 'Processed',\n+                };\n+\n+                return [\n+                    'transaction_id' => $t->transaction_id,\n+                    'type' => $t->type,\n+                    'amount' => $t->amount,\n+                    'date' => date('F d, Y', strtotime($t->date)),\n+                    'status' => $statusText,\n+                ];\n+            });\n+\n+        return $transactions;\n+\n+}\n+\n+\n+\n+    \n+}\n"
                },
                {
                    "date": 1764342965431,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,9 +63,9 @@\n {\n     $applicationTransactions = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n         ->select(\n-            DB::raw(\"CONCAT('APP-', a.id) as transaction_id\"),\n+            DB::raw(\"CONCAT('REQ - 0000', a.id) as transaction_id\"),\n             DB::raw(\"'Grant Request' as type\"),\n             DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n             'a.updated_at as date',\n             'a.status_id'\n@@ -109,116 +109,4 @@\n \n \n     \n }\n-<?php\n-\n-namespace App\\Http\\Controllers;\n-\n-use Illuminate\\Http\\Request;\n-use Illuminate\\Support\\Facades\\DB;\n-use App\\Models\\ReportFinancial;\n-\n-class ReportFinancialController extends Controller\n-{\n-\n-\n-    public function overAllBudget()\n-    {\n-\n-        $total = DB::table('grants as g')\n-            ->sum(DB::raw('g.total_quantity * g.amount_per_quantity'));\n-\n-        $total2 = DB::table('applications as a')\n-            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-        $combinedTotal = $total + $total2;\n-\n-        return $combinedTotal;\n-    }\n-public function totalGrantsReleased()\n-{\n-    // Sum of released grants based on actual applications\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 5) // 5 = released\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-\n-    return $total; // returns as float\n-}\n-\n-\n-\n-    // Optional: Budget Utilization (example)\n-    public function budgetUtilization()\n-    {\n-        $released = $this->totalGrantsReleased();\n-        $budget = $this->overAllBudget();\n-\n-        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n-    }\n-\n-public function pendingDisbursements()\n-{\n-    // Sum of all applications that are pending (status_id = 3)\n-    // Each request counts as 1, multiplied by the grant's unit_per_request and amount_per_quantity\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 3) // 3 = Pending\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n-\n-    return $total; // float\n-}\n-\n-\n-\n-public function recentTransactions()\n-{\n-    $applicationTransactions = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->select(\n-            DB::raw(\"CONCAT('APP-', a.id) as transaction_id\"),\n-            DB::raw(\"'Grant Request' as type\"),\n-            DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n-            'a.updated_at as date',\n-            'a.status_id'\n-        );\n-    $grantTransactions = DB::table('grants as g')\n-        ->select(\n-            DB::raw(\"CONCAT('GRANT-', g.id) as transaction_id\"),\n-            DB::raw(\"'Grant Allocation' as type\"),\n-            DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n-            'g.created_at as date',\n-            DB::raw(\"NULL as status_id\")\n-        );\n-        $transactions = $applicationTransactions\n-            ->unionAll($grantTransactions)\n-            ->orderBy('date', 'desc')\n-            ->limit(1000)\n-            ->get()\n-            ->map(function ($t) {\n-\n-                $status = (int) $t->status_id; // ðŸ”¥ force integer\n-\n-                $statusText = match($status) {\n-                    5 => 'Released',\n-                    3 => 'Pending',\n-                    default => 'Processed',\n-                };\n-\n-                return [\n-                    'transaction_id' => $t->transaction_id,\n-                    'type' => $t->type,\n-                    'amount' => $t->amount,\n-                    'date' => date('F d, Y', strtotime($t->date)),\n-                    'status' => $statusText,\n-                ];\n-            });\n-\n-        return $transactions;\n-\n-}\n-\n-\n-\n-    \n-}\n"
                },
                {
                    "date": 1764342983726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,9 +71,9 @@\n             'a.status_id'\n         );\n     $grantTransactions = DB::table('grants as g')\n         ->select(\n-            DB::raw(\"CONCAT('GRANT-', g.id) as transaction_id\"),\n+            DB::raw(\"CONCAT('GRANTS - 0000', g.id) as transaction_id\"),\n             DB::raw(\"'Grant Allocation' as type\"),\n             DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n"
                },
                {
                    "date": 1764343114183,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,17 +63,17 @@\n {\n     $applicationTransactions = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n         ->select(\n-            DB::raw(\"CONCAT('REQ - 0000', a.id) as transaction_id\"),\n+            DB::raw(\"CONCAT('REQ-0000', a.id) as transaction_id\"),\n             DB::raw(\"'Grant Request' as type\"),\n             DB::raw('(g.unit_per_request * g.amount_per_quantity) as amount'),\n             'a.updated_at as date',\n             'a.status_id'\n         );\n     $grantTransactions = DB::table('grants as g')\n         ->select(\n-            DB::raw(\"CONCAT('GRANTS - 0000', g.id) as transaction_id\"),\n+            DB::raw(\"CONCAT('GRANTS-0000', g.id) as transaction_id\"),\n             DB::raw(\"'Grant Allocation' as type\"),\n             DB::raw('(g.total_quantity * g.amount_per_quantity) as amount'),\n             'g.created_at as date',\n             DB::raw(\"NULL as status_id\")\n"
                },
                {
                    "date": 1764343171806,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,9 +87,9 @@\n \n                 $status = (int) $t->status_id; \n \n                 $statusText = match($status) {\n-                    5 => 'Completed',\n+                    5 => 'Released',\n                     3 => 'Pending',\n                     default => 'Processed',\n                 };\n \n"
                },
                {
                    "date": 1764343277406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,8 +89,9 @@\n \n                 $statusText = match($status) {\n                     5 => 'Released',\n                     3 => 'Pending',\n+                    3 => 'Approved',\n                     default => 'Processed',\n                 };\n \n                 return [\n"
                },
                {
                    "date": 1764343297077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,9 +89,9 @@\n \n                 $statusText = match($status) {\n                     5 => 'Released',\n                     3 => 'Pending',\n-                    3 => 'Approved',\n+                    4 => 'Approved',\n                     default => 'Processed',\n                 };\n \n                 return [\n"
                },
                {
                    "date": 1764343304617,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,10 +88,10 @@\n                 $status = (int) $t->status_id; \n \n                 $statusText = match($status) {\n                     5 => 'Released',\n+                    4 => 'Approved',\n                     3 => 'Pending',\n-                    4 => 'Approved',\n                     default => 'Processed',\n                 };\n \n                 return [\n"
                },
                {
                    "date": 1764343357335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,9 +90,9 @@\n                 $statusText = match($status) {\n                     5 => 'Released',\n                     4 => 'Approved',\n                     3 => 'Pending',\n-                    default => 'Processed',\n+                    default => 'Grants Allocation',\n                 };\n \n                 return [\n                     'transaction_id' => $t->transaction_id,\n"
                },
                {
                    "date": 1764343432353,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,11 +87,13 @@\n \n                 $status = (int) $t->status_id; \n \n                 $statusText = match($status) {\n+                    5 => 'Rejected',\n                     5 => 'Released',\n                     4 => 'Approved',\n                     3 => 'Pending',\n+                    \n                     default => 'Grants Allocation',\n                 };\n \n                 return [\n"
                },
                {
                    "date": 1764343549218,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,9 +87,10 @@\n \n                 $status = (int) $t->status_id; \n \n                 $statusText = match($status) {\n-                    5 => 'Rejected',\n+                    7 => 'To be review',\n+                    6 => 'Rejected',\n                     5 => 'Released',\n                     4 => 'Approved',\n                     3 => 'Pending',\n                     \n"
                },
                {
                    "date": 1764344800834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,9 +108,19 @@\n \n         return $transactions;\n \n }\n+public function budgetChartData()\n+{\n+    return [\n+        'overall' => $this->overAllBudget(),\n+        'released' => $this->totalGrantsReleased(),\n+        'pending' => $this->pendingDisbursements(),\n+        'expenses' => $this->totalExpenditures() // create this if needed\n+    ];\n+}\n \n \n \n+\n     \n }\n"
                },
                {
                    "date": 1764344838207,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,8 @@\n     return [\n         'overall' => $this->overAllBudget(),\n         'released' => $this->totalGrantsReleased(),\n         'pending' => $this->pendingDisbursements(),\n-        'expenses' => $this->totalExpenditures() // create this if needed\n     ];\n }\n \n \n"
                },
                {
                    "date": 1764344855566,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,9 +113,10 @@\n {\n     return [\n         'overall' => $this->overAllBudget(),\n         'released' => $this->totalGrantsReleased(),\n-        'pending' => $this->pendingDisbursements(),\n+        'pending' => $this->pendingDisbursements()\n+\n     ];\n }\n \n \n"
                },
                {
                    "date": 1764344941040,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,15 +108,22 @@\n \n         return $transactions;\n \n }\n+public function totalExpenditures()\n+{\n+    // Example: sum of all operational costs\n+    $total = DB::table('expenses')->sum('amount'); // adjust if your table/model is different\n+    return $total;\n+}\n+\n public function budgetChartData()\n {\n     return [\n         'overall' => $this->overAllBudget(),\n         'released' => $this->totalGrantsReleased(),\n-        'pending' => $this->pendingDisbursements()\n-\n+        'pending' => $this->pendingDisbursements(),\n+        'expenses' => $this->totalExpenditures()\n     ];\n }\n \n \n"
                },
                {
                    "date": 1764344963465,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,19 +115,9 @@\n     $total = DB::table('expenses')->sum('amount'); // adjust if your table/model is different\n     return $total;\n }\n \n-public function budgetChartData()\n-{\n-    return [\n-        'overall' => $this->overAllBudget(),\n-        'released' => $this->totalGrantsReleased(),\n-        'pending' => $this->pendingDisbursements(),\n-        'expenses' => $this->totalExpenditures()\n-    ];\n-}\n \n \n \n-\n     \n }\n"
                },
                {
                    "date": 1764345012292,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,16 +108,9 @@\n \n         return $transactions;\n \n }\n-public function totalExpenditures()\n-{\n-    // Example: sum of all operational costs\n-    $total = DB::table('expenses')->sum('amount'); // adjust if your table/model is different\n-    return $total;\n-}\n \n \n \n-\n     \n }\n"
                },
                {
                    "date": 1764345051651,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -109,8 +109,17 @@\n         return $transactions;\n \n }\n \n+public function budgetChartData()\n+{\n+    return [\n+        'overall'   => $this->overAllBudget(),\n+        'released'  => $this->totalGrantsReleased(),\n+        'pending'   => $this->pendingDisbursements(),\n+        'expenses'  => 0 // placeholder if you donâ€™t have expenditures yet\n+    ];\n+}\n \n \n     \n }\n"
                },
                {
                    "date": 1764347471547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -121,5 +121,112 @@\n }\n \n \n     \n+\n+\n+\n+public function exportPdf()\n+{\n+    $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n+    $combinedTotalValue = $this->overAllBudget() ?? 0;\n+    $budgetUtilization = $this->budgetUtilization() ?? 0;\n+    $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n+    $transactions = $this->recentTransactions() ?? [];\n+\n+    $logoPath = public_path('images/swisa-agap5.png');\n+\n+    $html = '\n+    <html>\n+    <head>\n+        <meta charset=\"utf-8\">\n+        <title>SwisaAGAP Financial Report</title>\n+        <style>\n+            body { font-family: DejaVu Sans, sans-serif; font-size: 10px; margin:0; padding:0; }\n+            .card { background:white; padding:10px; border-radius:8px; text-align:center; margin-bottom:10px; }\n+            .card h3 { color:#2C6E49; margin:5px 0; font-size:12px; }\n+            .card p { margin:0; font-weight:bold; font-size:14px; color:#2C6E49; }\n+            .modern-table th { background:#2C6E49; color:white; padding:8px; font-size:11px; text-align:left; }\n+            .modern-table td { padding:7px; font-size:10px; color:#333; border-bottom:1px solid #e5e7eb; }\n+            .modern-table tr:nth-child(even) { background:#f9f9f9; }\n+            .modern-table tr:nth-child(odd) { background:#ffffff; }\n+            .modern-header { margin:20px 0 10px 0; font-weight:bold; color:#2C6E49; font-size:14px; }\n+        </style>\n+    </head>\n+    <body>\n+        <div style=\"text-align:center; margin-bottom:10px;\">\n+            <img src=\"' . $logoPath . '\" width=\"120\">\n+        </div>\n+\n+        <div style=\"margin-bottom:20px; text-align:center;\">\n+            <h2 style=\"color:#2c6e49; margin-bottom:5px;\">Financial Reports</h2>\n+            <p style=\"color:#555; margin-top:-5px;\">Overview of grants, disbursements, and budget utilization</p>\n+        </div>\n+\n+        <!-- SUMMARY CARDS -->\n+        <table style=\"width:100%; border-collapse:collapse; margin-bottom:20px;\">\n+            <tr>\n+                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                    <h3>Overall Budget</h3>\n+                    <p>â‚± ' . number_format($combinedTotalValue,2) . '</p>\n+                </td>\n+                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                    <h3>Total Grants Released</h3>\n+                    <p>â‚± ' . number_format($totalGrantsReleased,2) . '</p>\n+                </td>\n+                <td class=\"card\" style=\"border-top:4px solid #1E88E5;\">\n+                    <h3>Budget Utilization</h3>\n+                    <p>' . $budgetUtilization . '%</p>\n+                </td>\n+                <td class=\"card\" style=\"border-top:4px solid #FFC107;\">\n+                    <h3>Pending Disbursements</h3>\n+                    <p>â‚± ' . number_format($pendingDisbursements,2) . '</p>\n+                </td>\n+            </tr>\n+        </table>\n+\n+        <!-- FINANCIAL TRANSACTIONS TABLE -->\n+        <div class=\"section\">\n+            <h3 class=\"modern-header\">Recent Financial Transactions</h3>\n+            <table class=\"modern-table\" style=\"width:100%; border-collapse:collapse;\">\n+                <thead>\n+                    <tr>\n+                        <th>Transaction ID</th>\n+                        <th>Type</th>\n+                        <th>Amount</th>\n+                        <th>Date</th>\n+                        <th>Status</th>\n+                    </tr>\n+                </thead>\n+                <tbody>';\n+\n+                foreach ($transactions as $t) {\n+                    $color = match($t['status']) {\n+                        'Released' => '#2C6E49',\n+                        'Pending' => '#FFC107',\n+                        'Approved' => '#1E88E5',\n+                        'Rejected' => '#FF3B30',\n+                        default => '#333'\n+                    };\n+                    $html .= '<tr>\n+                        <td>' . $t['transaction_id'] . '</td>\n+                        <td>' . $t['type'] . '</td>\n+                        <td style=\"font-weight:bold; color:' . $color . ';\">â‚± ' . number_format($t['amount'],2) . '</td>\n+                        <td>' . $t['date'] . '</td>\n+                        <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n+                    </tr>';\n+                }\n+\n+    $html .= '\n+                </tbody>\n+            </table>\n+        </div>\n+\n+        <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n+    </body>\n+    </html>';\n+\n+    $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n+    return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n }\n+\n+}\n"
                },
                {
                    "date": 1764347760594,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,15 @@\n use Illuminate\\Http\\Request;\n use Illuminate\\Support\\Facades\\DB;\n use App\\Models\\ReportFinancial;\n \n+use Illuminate\\Support\\Facades\\Response;\n+use PhpOffice\\PhpSpreadsheet\\Spreadsheet;\n+use PhpOffice\\PhpSpreadsheet\\Writer\\Xlsx;\n+use Barryvdh\\DomPDF\\Facade\\Pdf;\n+use Carbon\\Carbon;\n+\n+\n class ReportFinancialController extends Controller\n {\n \n \n"
                },
                {
                    "date": 1764347849140,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -179,13 +179,13 @@\n                 <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n                     <h3>Total Grants Released</h3>\n                     <p>â‚± ' . number_format($totalGrantsReleased,2) . '</p>\n                 </td>\n-                <td class=\"card\" style=\"border-top:4px solid #1E88E5;\">\n+                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n                     <h3>Budget Utilization</h3>\n                     <p>' . $budgetUtilization . '%</p>\n                 </td>\n-                <td class=\"card\" style=\"border-top:4px solid #FFC107;\">\n+                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n                     <h3>Pending Disbursements</h3>\n                     <p>â‚± ' . number_format($pendingDisbursements,2) . '</p>\n                 </td>\n             </tr>\n"
                },
                {
                    "date": 1764347901146,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,9 +163,9 @@\n         <div style=\"text-align:center; margin-bottom:10px;\">\n             <img src=\"' . $logoPath . '\" width=\"120\">\n         </div>\n \n-        <div style=\"margin-bottom:20px; text-align:center;\">\n+        <div style=\"margin-bottom:20px; text-align:start;\">\n             <h2 style=\"color:#2c6e49; margin-bottom:5px;\">Financial Reports</h2>\n             <p style=\"color:#555; margin-top:-5px;\">Overview of grants, disbursements, and budget utilization</p>\n         </div>\n \n"
                },
                {
                    "date": 1764348183829,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,8 +227,22 @@\n                 </tbody>\n             </table>\n         </div>\n \n+        foreach ($budgetData as $label => $value) {\n+    $percent = ($value / $maxValue) * 100;\n+    $html .= '\n+        <div style=\"margin-bottom:5px;\">\n+            <strong>'.$label.'</strong>\n+            <div style=\"background:#f0f0f0; border-radius:5px;\">\n+                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:4px; color:white; border-radius:5px;\">\n+                    '.$value.'\n+                </div>\n+            </div>\n+        </div>';\n+}\n+\n+\n         <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n     </body>\n     </html>';\n \n"
                },
                {
                    "date": 1764348201223,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -226,23 +226,10 @@\n     $html .= '\n                 </tbody>\n             </table>\n         </div>\n+        \n \n-        foreach ($budgetData as $label => $value) {\n-    $percent = ($value / $maxValue) * 100;\n-    $html .= '\n-        <div style=\"margin-bottom:5px;\">\n-            <strong>'.$label.'</strong>\n-            <div style=\"background:#f0f0f0; border-radius:5px;\">\n-                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:4px; color:white; border-radius:5px;\">\n-                    '.$value.'\n-                </div>\n-            </div>\n-        </div>';\n-}\n-\n-\n         <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n     </body>\n     </html>';\n \n"
                },
                {
                    "date": 1764348219508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -226,10 +226,21 @@\n     $html .= '\n                 </tbody>\n             </table>\n         </div>\n-        \n+        foreach ($budgetData as $label => $value) {\n+    $percent = ($value / $maxValue) * 100;\n+        <div style=\"margin-bottom:5px;\">\n+            <strong>'.$label.'</strong>\n+            <div style=\"background:#f0f0f0; border-radius:5px;\">\n+                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:4px; color:white; border-radius:5px;\">\n+                    '.$value.'\n+                </div>\n+            </div>\n+        </div>\n+}\n \n+\n         <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n     </body>\n     </html>';\n \n"
                },
                {
                    "date": 1764348322927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -139,8 +139,18 @@\n     $budgetUtilization = $this->budgetUtilization() ?? 0;\n     $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n     $transactions = $this->recentTransactions() ?? [];\n \n+    // Example budget data\n+    $budgetData = [\n+        'Overall Budget' => $combinedTotalValue,\n+        'Total Grants Released' => $totalGrantsReleased,\n+        'Budget Utilization (%)' => $budgetUtilization,\n+        'Pending Disbursements' => $pendingDisbursements,\n+    ];\n+\n+    $maxValue = max($budgetData);\n+\n     $logoPath = public_path('images/swisa-agap5.png');\n \n     $html = '\n     <html>\n@@ -190,10 +200,26 @@\n                 </td>\n             </tr>\n         </table>\n \n+        <!-- BUDGET ALLOCATION CHART (CSS Bars) -->';\n+\n+    foreach ($budgetData as $label => $value) {\n+        $percent = ($value / max($maxValue, 1)) * 100;\n+        $html .= '\n+        <div style=\"margin-bottom:5px;\">\n+            <strong style=\"color:#2C6E49;\">'.$label.'</strong>\n+            <div style=\"background:#f0f0f0; border-radius:5px; height:18px;\">\n+                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:2px 4px; color:white; font-size:10px; font-weight:bold; border-radius:5px; text-align:right;\">\n+                    ' . (str_contains($label, 'Utilization') ? $value.'%' : 'â‚± '.number_format($value,2)) . '\n+                </div>\n+            </div>\n+        </div>';\n+    }\n+\n+    $html .= '\n         <!-- FINANCIAL TRANSACTIONS TABLE -->\n-        <div class=\"section\">\n+        <div class=\"section\" style=\"margin-top:15px;\">\n             <h3 class=\"modern-header\">Recent Financial Transactions</h3>\n             <table class=\"modern-table\" style=\"width:100%; border-collapse:collapse;\">\n                 <thead>\n                     <tr>\n@@ -205,47 +231,36 @@\n                     </tr>\n                 </thead>\n                 <tbody>';\n \n-                foreach ($transactions as $t) {\n-                    $color = match($t['status']) {\n-                        'Released' => '#2C6E49',\n-                        'Pending' => '#FFC107',\n-                        'Approved' => '#1E88E5',\n-                        'Rejected' => '#FF3B30',\n-                        default => '#333'\n-                    };\n-                    $html .= '<tr>\n-                        <td>' . $t['transaction_id'] . '</td>\n-                        <td>' . $t['type'] . '</td>\n-                        <td style=\"font-weight:bold; color:' . $color . ';\">â‚± ' . number_format($t['amount'],2) . '</td>\n-                        <td>' . $t['date'] . '</td>\n-                        <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n-                    </tr>';\n-                }\n+    foreach ($transactions as $t) {\n+        $color = match($t['status']) {\n+            'Released' => '#2C6E49',\n+            'Pending' => '#FFC107',\n+            'Approved' => '#1E88E5',\n+            'Rejected' => '#FF3B30',\n+            default => '#333'\n+        };\n+        $html .= '<tr>\n+            <td>' . $t['transaction_id'] . '</td>\n+            <td>' . $t['type'] . '</td>\n+            <td style=\"font-weight:bold; color:' . $color . ';\">' . (str_contains($t['type'], 'Utilization') ? $t['amount'].'%' : 'â‚± '.number_format($t['amount'],2)) . '</td>\n+            <td>' . $t['date'] . '</td>\n+            <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n+        </tr>';\n+    }\n \n     $html .= '\n                 </tbody>\n             </table>\n         </div>\n-        foreach ($budgetData as $label => $value) {\n-    $percent = ($value / $maxValue) * 100;\n-        <div style=\"margin-bottom:5px;\">\n-            <strong>'.$label.'</strong>\n-            <div style=\"background:#f0f0f0; border-radius:5px;\">\n-                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:4px; color:white; border-radius:5px;\">\n-                    '.$value.'\n-                </div>\n-            </div>\n-        </div>\n-}\n \n-\n         <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n     </body>\n     </html>';\n \n     $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n     return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n }\n \n+\n }\n"
                },
                {
                    "date": 1764348604600,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -133,26 +133,25 @@\n \n \n public function exportPdf()\n {\n+    // --- DATA ---\n     $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n     $combinedTotalValue = $this->overAllBudget() ?? 0;\n     $budgetUtilization = $this->budgetUtilization() ?? 0;\n     $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n     $transactions = $this->recentTransactions() ?? [];\n-\n-    // Example budget data\n     $budgetData = [\n         'Overall Budget' => $combinedTotalValue,\n         'Total Grants Released' => $totalGrantsReleased,\n         'Budget Utilization (%)' => $budgetUtilization,\n-        'Pending Disbursements' => $pendingDisbursements,\n+        'Pending Disbursements' => $pendingDisbursements\n     ];\n-\n     $maxValue = max($budgetData);\n \n     $logoPath = public_path('images/swisa-agap5.png');\n \n+    // --- HTML ---\n     $html = '\n     <html>\n     <head>\n         <meta charset=\"utf-8\">\n@@ -200,26 +199,37 @@\n                 </td>\n             </tr>\n         </table>\n \n-        <!-- BUDGET ALLOCATION CHART (CSS Bars) -->';\n+        <!-- BUDGET ALLOCATION CHART -->\n+        <div style=\"margin-bottom:20px;\">\n+            <h3 style=\"color:#2C6E49; font-weight:bold; margin-bottom:10px;\">Budget Allocation Overview</h3>';\n \n+    $colors = ['#2C6E49', '#4CAF50', '#1E88E5', '#FFC107'];\n+    $i = 0;\n     foreach ($budgetData as $label => $value) {\n         $percent = ($value / max($maxValue, 1)) * 100;\n+        $displayValue = str_contains($label, 'Utilization') ? $value.'%' : 'â‚± '.number_format($value,2);\n+        $color = $colors[$i % count($colors)];\n+\n         $html .= '\n-        <div style=\"margin-bottom:5px;\">\n-            <strong style=\"color:#2C6E49;\">'.$label.'</strong>\n-            <div style=\"background:#f0f0f0; border-radius:5px; height:18px;\">\n-                <div style=\"width:'.$percent.'%; background:#2C6E49; padding:2px 4px; color:white; font-size:10px; font-weight:bold; border-radius:5px; text-align:right;\">\n-                    ' . (str_contains($label, 'Utilization') ? $value.'%' : 'â‚± '.number_format($value,2)) . '\n-                </div>\n+        <div style=\"margin-bottom:8px;\">\n+            <div style=\"display:flex; justify-content:space-between; font-size:10px; margin-bottom:3px; color:#2C6E49;\">\n+                <span>'.$label.'</span>\n+                <span>'.$displayValue.'</span>\n             </div>\n+            <div style=\"background:#e5e7eb; border-radius:6px; height:18px; width:100%;\">\n+                <div style=\"width:'.$percent.'%; background:'.$color.'; height:100%; border-radius:6px;\"></div>\n+            </div>\n         </div>';\n+        $i++;\n     }\n \n+    $html .= '</div>';\n+\n+    // --- FINANCIAL TRANSACTIONS TABLE ---\n     $html .= '\n-        <!-- FINANCIAL TRANSACTIONS TABLE -->\n-        <div class=\"section\" style=\"margin-top:15px;\">\n+        <div class=\"section\">\n             <h3 class=\"modern-header\">Recent Financial Transactions</h3>\n             <table class=\"modern-table\" style=\"width:100%; border-collapse:collapse;\">\n                 <thead>\n                     <tr>\n@@ -242,9 +252,9 @@\n         };\n         $html .= '<tr>\n             <td>' . $t['transaction_id'] . '</td>\n             <td>' . $t['type'] . '</td>\n-            <td style=\"font-weight:bold; color:' . $color . ';\">' . (str_contains($t['type'], 'Utilization') ? $t['amount'].'%' : 'â‚± '.number_format($t['amount'],2)) . '</td>\n+            <td style=\"font-weight:bold; color:' . $color . ';\">' . (str_contains($t['type'],'Utilization') ? $t['amount'].'%' : 'â‚± '.number_format($t['amount'],2)) . '</td>\n             <td>' . $t['date'] . '</td>\n             <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n         </tr>';\n     }\n@@ -257,8 +267,9 @@\n         <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n     </body>\n     </html>';\n \n+    // --- GENERATE PDF ---\n     $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n     return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n }\n \n"
                },
                {
                    "date": 1764348914113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,46 +29,46 @@\n         $combinedTotal = $total + $total2;\n \n         return $combinedTotal;\n     }\n-public function totalGrantsReleased()\n-{\n-    // Sum of released grants based on actual applications\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 5) // 5 = released\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n+    public function totalGrantsReleased()\n+    {\n+        // Sum of released grants based on actual applications\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 5) // 5 = released\n+            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-    return $total; // returns as float\n-}\n+        return $total; // returns as float\n+    }\n \n \n \n-    // Optional: Budget Utilization (example)\n-    public function budgetUtilization()\n+        // Optional: Budget Utilization (example)\n+        public function budgetUtilization()\n+        {\n+            $released = $this->totalGrantsReleased();\n+            $budget = $this->overAllBudget();\n+\n+            return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n+        }\n+\n+    public function pendingDisbursements()\n     {\n-        $released = $this->totalGrantsReleased();\n-        $budget = $this->overAllBudget();\n+        // Sum of all applications that are pending (status_id = 3)\n+        // Each request counts as 1, multiplied by the grant's unit_per_request and amount_per_quantity\n+        $total = DB::table('applications as a')\n+            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n+            ->where('a.status_id', 3) // 3 = Pending\n+            ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-        return $budget > 0 ? round(($released / $budget) * 100, 2) : 0;\n+        return $total; // float\n     }\n \n-public function pendingDisbursements()\n-{\n-    // Sum of all applications that are pending (status_id = 3)\n-    // Each request counts as 1, multiplied by the grant's unit_per_request and amount_per_quantity\n-    $total = DB::table('applications as a')\n-        ->join('grants as g', 'a.grant_id', '=', 'g.id')\n-        ->where('a.status_id', 3) // 3 = Pending\n-        ->sum(DB::raw('g.unit_per_request * g.amount_per_quantity'));\n \n-    return $total; // float\n-}\n \n-\n-\n-public function recentTransactions()\n-{\n+    public function recentTransactions()\n+    {\n     $applicationTransactions = DB::table('applications as a')\n         ->join('grants as g', 'a.grant_id', '=', 'g.id')\n         ->select(\n             DB::raw(\"CONCAT('REQ-0000', a.id) as transaction_id\"),\n@@ -114,164 +114,164 @@\n             });\n \n         return $transactions;\n \n-}\n+    }\n \n-public function budgetChartData()\n-{\n-    return [\n-        'overall'   => $this->overAllBudget(),\n-        'released'  => $this->totalGrantsReleased(),\n-        'pending'   => $this->pendingDisbursements(),\n-        'expenses'  => 0 // placeholder if you donâ€™t have expenditures yet\n-    ];\n-}\n+    public function budgetChartData()\n+    {\n+        return [\n+            'overall'   => $this->overAllBudget(),\n+            'released'  => $this->totalGrantsReleased(),\n+            'pending'   => $this->pendingDisbursements(),\n+            'expenses'  => 0 // placeholder if you donâ€™t have expenditures yet\n+        ];\n+    }\n \n \n-    \n+        \n \n \n \n-public function exportPdf()\n-{\n-    // --- DATA ---\n-    $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n-    $combinedTotalValue = $this->overAllBudget() ?? 0;\n-    $budgetUtilization = $this->budgetUtilization() ?? 0;\n-    $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n-    $transactions = $this->recentTransactions() ?? [];\n-    $budgetData = [\n-        'Overall Budget' => $combinedTotalValue,\n-        'Total Grants Released' => $totalGrantsReleased,\n-        'Budget Utilization (%)' => $budgetUtilization,\n-        'Pending Disbursements' => $pendingDisbursements\n-    ];\n-    $maxValue = max($budgetData);\n+    public function exportPdf()\n+    {\n+        // --- DATA ---\n+        $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n+        $combinedTotalValue = $this->overAllBudget() ?? 0;\n+        $budgetUtilization = $this->budgetUtilization() ?? 0;\n+        $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n+        $transactions = $this->recentTransactions() ?? [];\n+        $budgetData = [\n+            'Overall Budget' => $combinedTotalValue,\n+            'Total Grants Released' => $totalGrantsReleased,\n+            'Budget Utilization (%)' => $budgetUtilization,\n+            'Pending Disbursements' => $pendingDisbursements\n+        ];\n+        $maxValue = max($budgetData);\n \n-    $logoPath = public_path('images/swisa-agap5.png');\n+        $logoPath = public_path('images/swisa-agap5.png');\n \n-    // --- HTML ---\n-    $html = '\n-    <html>\n-    <head>\n-        <meta charset=\"utf-8\">\n-        <title>SwisaAGAP Financial Report</title>\n-        <style>\n-            body { font-family: DejaVu Sans, sans-serif; font-size: 10px; margin:0; padding:0; }\n-            .card { background:white; padding:10px; border-radius:8px; text-align:center; margin-bottom:10px; }\n-            .card h3 { color:#2C6E49; margin:5px 0; font-size:12px; }\n-            .card p { margin:0; font-weight:bold; font-size:14px; color:#2C6E49; }\n-            .modern-table th { background:#2C6E49; color:white; padding:8px; font-size:11px; text-align:left; }\n-            .modern-table td { padding:7px; font-size:10px; color:#333; border-bottom:1px solid #e5e7eb; }\n-            .modern-table tr:nth-child(even) { background:#f9f9f9; }\n-            .modern-table tr:nth-child(odd) { background:#ffffff; }\n-            .modern-header { margin:20px 0 10px 0; font-weight:bold; color:#2C6E49; font-size:14px; }\n-        </style>\n-    </head>\n-    <body>\n-        <div style=\"text-align:center; margin-bottom:10px;\">\n-            <img src=\"' . $logoPath . '\" width=\"120\">\n-        </div>\n+        // --- HTML ---\n+        $html = '\n+        <html>\n+        <head>\n+            <meta charset=\"utf-8\">\n+            <title>SwisaAGAP Financial Report</title>\n+            <style>\n+                body { font-family: DejaVu Sans, sans-serif; font-size: 10px; margin:0; padding:0; }\n+                .card { background:white; padding:10px; border-radius:8px; text-align:center; margin-bottom:10px; }\n+                .card h3 { color:#2C6E49; margin:5px 0; font-size:12px; }\n+                .card p { margin:0; font-weight:bold; font-size:14px; color:#2C6E49; }\n+                .modern-table th { background:#2C6E49; color:white; padding:8px; font-size:11px; text-align:left; }\n+                .modern-table td { padding:7px; font-size:10px; color:#333; border-bottom:1px solid #e5e7eb; }\n+                .modern-table tr:nth-child(even) { background:#f9f9f9; }\n+                .modern-table tr:nth-child(odd) { background:#ffffff; }\n+                .modern-header { margin:20px 0 10px 0; font-weight:bold; color:#2C6E49; font-size:14px; }\n+            </style>\n+        </head>\n+        <body>\n+            <div style=\"text-align:center; margin-bottom:10px;\">\n+                <img src=\"' . $logoPath . '\" width=\"120\">\n+            </div>\n \n-        <div style=\"margin-bottom:20px; text-align:start;\">\n-            <h2 style=\"color:#2c6e49; margin-bottom:5px;\">Financial Reports</h2>\n-            <p style=\"color:#555; margin-top:-5px;\">Overview of grants, disbursements, and budget utilization</p>\n-        </div>\n+            <div style=\"margin-bottom:20px; text-align:start;\">\n+                <h2 style=\"color:#2c6e49; margin-bottom:5px;\">Financial Reports</h2>\n+                <p style=\"color:#555; margin-top:-5px;\">Overview of grants, disbursements, and budget utilization</p>\n+            </div>\n \n-        <!-- SUMMARY CARDS -->\n-        <table style=\"width:100%; border-collapse:collapse; margin-bottom:20px;\">\n-            <tr>\n-                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n-                    <h3>Overall Budget</h3>\n-                    <p>â‚± ' . number_format($combinedTotalValue,2) . '</p>\n-                </td>\n-                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n-                    <h3>Total Grants Released</h3>\n-                    <p>â‚± ' . number_format($totalGrantsReleased,2) . '</p>\n-                </td>\n-                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n-                    <h3>Budget Utilization</h3>\n-                    <p>' . $budgetUtilization . '%</p>\n-                </td>\n-                <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n-                    <h3>Pending Disbursements</h3>\n-                    <p>â‚± ' . number_format($pendingDisbursements,2) . '</p>\n-                </td>\n-            </tr>\n-        </table>\n+            <!-- SUMMARY CARDS -->\n+            <table style=\"width:100%; border-collapse:collapse; margin-bottom:20px;\">\n+                <tr>\n+                    <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                        <h3>Overall Budget</h3>\n+                        <p>â‚± ' . number_format($combinedTotalValue,2) . '</p>\n+                    </td>\n+                    <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                        <h3>Total Grants Released</h3>\n+                        <p>â‚± ' . number_format($totalGrantsReleased,2) . '</p>\n+                    </td>\n+                    <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                        <h3>Budget Utilization</h3>\n+                        <p>' . $budgetUtilization . '%</p>\n+                    </td>\n+                    <td class=\"card\" style=\"border-top:4px solid #2C6E49;\">\n+                        <h3>Pending Disbursements</h3>\n+                        <p>â‚± ' . number_format($pendingDisbursements,2) . '</p>\n+                    </td>\n+                </tr>\n+            </table>\n \n-        <!-- BUDGET ALLOCATION CHART -->\n-        <div style=\"margin-bottom:20px;\">\n-            <h3 style=\"color:#2C6E49; font-weight:bold; margin-bottom:10px;\">Budget Allocation Overview</h3>';\n+            <!-- BUDGET ALLOCATION CHART -->\n+            <div style=\"margin-bottom:20px;\">\n+                <h3 style=\"color:#2C6E49; font-weight:bold; margin-bottom:10px;\">Budget Allocation Overview</h3>';\n \n-    $colors = ['#2C6E49', '#4CAF50', '#1E88E5', '#FFC107'];\n-    $i = 0;\n-    foreach ($budgetData as $label => $value) {\n-        $percent = ($value / max($maxValue, 1)) * 100;\n-        $displayValue = str_contains($label, 'Utilization') ? $value.'%' : 'â‚± '.number_format($value,2);\n-        $color = $colors[$i % count($colors)];\n+        $colors = ['#2C6E49', '#4CAF50', '#1E88E5', '#FFC107'];\n+        $i = 0;\n+        foreach ($budgetData as $label => $value) {\n+            $percent = ($value / max($maxValue, 1)) * 100;\n+            $displayValue = str_contains($label, 'Utilization') ? $value.'%' : 'â‚± '.number_format($value,2);\n+            $color = $colors[$i % count($colors)];\n \n-        $html .= '\n-        <div style=\"margin-bottom:8px;\">\n-            <div style=\"display:flex; justify-content:space-between; font-size:10px; margin-bottom:3px; color:#2C6E49;\">\n-                <span>'.$label.'</span>\n-                <span>'.$displayValue.'</span>\n-            </div>\n-            <div style=\"background:#e5e7eb; border-radius:6px; height:18px; width:100%;\">\n-                <div style=\"width:'.$percent.'%; background:'.$color.'; height:100%; border-radius:6px;\"></div>\n-            </div>\n-        </div>';\n-        $i++;\n-    }\n+            $html .= '\n+            <div style=\"margin-bottom:8px;\">\n+                <div style=\"display:flex; justify-content:space-between; font-size:10px; margin-bottom:3px; color:#2C6E49;\">\n+                    <span>'.$label.'</span>\n+                    <span>'.$displayValue.'</span>\n+                </div>\n+                <div style=\"background:#e5e7eb; border-radius:6px; height:18px; width:100%;\">\n+                    <div style=\"width:'.$percent.'%; background:'.$color.'; height:100%; border-radius:6px;\"></div>\n+                </div>\n+            </div>';\n+            $i++;\n+        }\n \n-    $html .= '</div>';\n+        $html .= '</div>';\n \n-    // --- FINANCIAL TRANSACTIONS TABLE ---\n-    $html .= '\n-        <div class=\"section\">\n-            <h3 class=\"modern-header\">Recent Financial Transactions</h3>\n-            <table class=\"modern-table\" style=\"width:100%; border-collapse:collapse;\">\n-                <thead>\n-                    <tr>\n-                        <th>Transaction ID</th>\n-                        <th>Type</th>\n-                        <th>Amount</th>\n-                        <th>Date</th>\n-                        <th>Status</th>\n-                    </tr>\n-                </thead>\n-                <tbody>';\n+        // --- FINANCIAL TRANSACTIONS TABLE ---\n+        $html .= '\n+            <div class=\"section\">\n+                <h3 class=\"modern-header\">Recent Financial Transactions</h3>\n+                <table class=\"modern-table\" style=\"width:100%; border-collapse:collapse;\">\n+                    <thead>\n+                        <tr>\n+                            <th>Transaction ID</th>\n+                            <th>Type</th>\n+                            <th>Amount</th>\n+                            <th>Date</th>\n+                            <th>Status</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>';\n \n-    foreach ($transactions as $t) {\n-        $color = match($t['status']) {\n-            'Released' => '#2C6E49',\n-            'Pending' => '#FFC107',\n-            'Approved' => '#1E88E5',\n-            'Rejected' => '#FF3B30',\n-            default => '#333'\n-        };\n-        $html .= '<tr>\n-            <td>' . $t['transaction_id'] . '</td>\n-            <td>' . $t['type'] . '</td>\n-            <td style=\"font-weight:bold; color:' . $color . ';\">' . (str_contains($t['type'],'Utilization') ? $t['amount'].'%' : 'â‚± '.number_format($t['amount'],2)) . '</td>\n-            <td>' . $t['date'] . '</td>\n-            <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n-        </tr>';\n-    }\n+        foreach ($transactions as $t) {\n+            $color = match($t['status']) {\n+                'Released' => '#2C6E49',\n+                'Pending' => '#FFC107',\n+                'Approved' => '#1E88E5',\n+                'Rejected' => '#FF3B30',\n+                default => '#333'\n+            };\n+            $html .= '<tr>\n+                <td>' . $t['transaction_id'] . '</td>\n+                <td>' . $t['type'] . '</td>\n+                <td style=\"font-weight:bold; color:' . $color . ';\">' . (str_contains($t['type'],'Utilization') ? $t['amount'].'%' : 'â‚± '.number_format($t['amount'],2)) . '</td>\n+                <td>' . $t['date'] . '</td>\n+                <td style=\"font-weight:bold; color:' . $color . ';\">' . $t['status'] . '</td>\n+            </tr>';\n+        }\n \n-    $html .= '\n-                </tbody>\n-            </table>\n-        </div>\n+        $html .= '\n+                    </tbody>\n+                </table>\n+            </div>\n \n-        <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n-    </body>\n-    </html>';\n+            <p style=\"margin-top:15px;\">Latest as of ' . now()->format('F d, Y') . '</p>\n+        </body>\n+        </html>';\n \n-    // --- GENERATE PDF ---\n-    $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n-    return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n-}\n+        // --- GENERATE PDF ---\n+        $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n+        return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n+    }\n \n \n }\n"
                },
                {
                    "date": 1764349210339,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -272,6 +272,119 @@\n         $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n         return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n     }\n \n+public function exportCsv()\n+{\n+    $transactions = $this->recentTransactions() ?? [];\n+    $budgetData = [\n+        'Overall Budget' => $this->overAllBudget() ?? 0,\n+        'Total Grants Released' => $this->totalGrantsReleased() ?? 0,\n+        'Budget Utilization (%)' => $this->budgetUtilization() ?? 0,\n+        'Pending Disbursements' => $this->pendingDisbursements() ?? 0\n+    ];\n \n+    $spreadsheet = new \\PhpOffice\\PhpSpreadsheet\\Spreadsheet();\n+    $sheet = $spreadsheet->getActiveSheet();\n+\n+    $row = 1;\n+\n+    // Budget Summary\n+    $sheet->setCellValue('A' . $row, 'Financial Summary');\n+    $row++;\n+    foreach ($budgetData as $key => $value) {\n+        $sheet->setCellValue('A' . $row, $key);\n+        $sheet->setCellValue('B' . $row, $value);\n+        $row++;\n+    }\n+\n+    $row++; // empty row\n+\n+    // Transactions Header\n+    $sheet->setCellValue('A' . $row, 'Transaction ID');\n+    $sheet->setCellValue('B' . $row, 'Type');\n+    $sheet->setCellValue('C' . $row, 'Amount');\n+    $sheet->setCellValue('D' . $row, 'Date');\n+    $sheet->setCellValue('E' . $row, 'Status');\n+    $row++;\n+\n+    // Transactions Data\n+    foreach ($transactions as $t) {\n+        $sheet->setCellValue('A' . $row, $t['transaction_id']);\n+        $sheet->setCellValue('B' . $row, $t['type']);\n+        $sheet->setCellValue('C' . $row, $t['amount']);\n+        $sheet->setCellValue('D' . $row, $t['date']);\n+        $sheet->setCellValue('E' . $row, $t['status']);\n+        $row++;\n+    }\n+\n+    $filename = 'swisa_financial_report_' . now()->format('Ymd_His') . '.csv';\n+\n+    header('Content-Type: text/csv');\n+    header('Content-Disposition: attachment;filename=\"' . $filename . '\"');\n+    header('Cache-Control: max-age=0');\n+\n+    $writer = new \\PhpOffice\\PhpSpreadsheet\\Writer\\Csv($spreadsheet);\n+    $writer->save('php://output');\n+    exit;\n }\n+public function exportExcel()\n+{\n+    $transactions = $this->recentTransactions() ?? [];\n+    $budgetData = [\n+        'Overall Budget' => $this->overAllBudget() ?? 0,\n+        'Total Grants Released' => $this->totalGrantsReleased() ?? 0,\n+        'Budget Utilization (%)' => $this->budgetUtilization() ?? 0,\n+        'Pending Disbursements' => $this->pendingDisbursements() ?? 0\n+    ];\n+\n+    $spreadsheet = new Spreadsheet();\n+    $sheet = $spreadsheet->getActiveSheet();\n+\n+    $row = 1;\n+\n+    // Budget Summary\n+    $sheet->setCellValue('A' . $row, 'Financial Summary');\n+    $row++;\n+    foreach ($budgetData as $key => $value) {\n+        $sheet->setCellValue('A' . $row, $key);\n+        $sheet->setCellValue('B' . $row, $value);\n+        $row++;\n+    }\n+\n+    $row++; // empty row\n+\n+    // Transactions Header\n+    $sheet->setCellValue('A' . $row, 'Transaction ID');\n+    $sheet->setCellValue('B' . $row, 'Type');\n+    $sheet->setCellValue('C' . $row, 'Amount');\n+    $sheet->setCellValue('D' . $row, 'Date');\n+    $sheet->setCellValue('E' . $row, 'Status');\n+    $row++;\n+\n+    // Transactions Data\n+    foreach ($transactions as $t) {\n+        $sheet->setCellValue('A' . $row, $t['transaction_id']);\n+        $sheet->setCellValue('B' . $row, $t['type']);\n+        $sheet->setCellValue('C' . $row, $t['amount']);\n+        $sheet->setCellValue('D' . $row, $t['date']);\n+        $sheet->setCellValue('E' . $row, $t['status']);\n+        $row++;\n+    }\n+\n+    // Auto size columns\n+    foreach (range('A', 'E') as $col) {\n+        $sheet->getColumnDimension($col)->setAutoSize(true);\n+    }\n+\n+    $filename = 'swisa_financial_report_' . now()->format('Ymd_His') . '.xlsx';\n+\n+    header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n+    header('Content-Disposition: attachment;filename=\"' . $filename . '\"');\n+    header('Cache-Control: max-age=0');\n+\n+    $writer = new Xlsx($spreadsheet);\n+    $writer->save('php://output');\n+    exit;\n+}\n+\n+}\n"
                },
                {
                    "date": 1764349348089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -272,119 +272,54 @@\n         $pdf = Pdf::loadHTML($html)->setPaper('A4', 'landscape');\n         return $pdf->download('swisa_financial_report_' . now()->format('Ymd_His') . '.pdf');\n     }\n \n-public function exportCsv()\n+public function exportFinancialCsv()\n {\n+    $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n+    $combinedTotalValue = $this->overAllBudget() ?? 0;\n+    $budgetUtilization = $this->budgetUtilization() ?? 0;\n+    $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n     $transactions = $this->recentTransactions() ?? [];\n-    $budgetData = [\n-        'Overall Budget' => $this->overAllBudget() ?? 0,\n-        'Total Grants Released' => $this->totalGrantsReleased() ?? 0,\n-        'Budget Utilization (%)' => $this->budgetUtilization() ?? 0,\n-        'Pending Disbursements' => $this->pendingDisbursements() ?? 0\n-    ];\n \n-    $spreadsheet = new \\PhpOffice\\PhpSpreadsheet\\Spreadsheet();\n-    $sheet = $spreadsheet->getActiveSheet();\n-\n-    $row = 1;\n-\n-    // Budget Summary\n-    $sheet->setCellValue('A' . $row, 'Financial Summary');\n-    $row++;\n-    foreach ($budgetData as $key => $value) {\n-        $sheet->setCellValue('A' . $row, $key);\n-        $sheet->setCellValue('B' . $row, $value);\n-        $row++;\n-    }\n-\n-    $row++; // empty row\n-\n-    // Transactions Header\n-    $sheet->setCellValue('A' . $row, 'Transaction ID');\n-    $sheet->setCellValue('B' . $row, 'Type');\n-    $sheet->setCellValue('C' . $row, 'Amount');\n-    $sheet->setCellValue('D' . $row, 'Date');\n-    $sheet->setCellValue('E' . $row, 'Status');\n-    $row++;\n-\n-    // Transactions Data\n-    foreach ($transactions as $t) {\n-        $sheet->setCellValue('A' . $row, $t['transaction_id']);\n-        $sheet->setCellValue('B' . $row, $t['type']);\n-        $sheet->setCellValue('C' . $row, $t['amount']);\n-        $sheet->setCellValue('D' . $row, $t['date']);\n-        $sheet->setCellValue('E' . $row, $t['status']);\n-        $row++;\n-    }\n-\n     $filename = 'swisa_financial_report_' . now()->format('Ymd_His') . '.csv';\n-\n-    header('Content-Type: text/csv');\n-    header('Content-Disposition: attachment;filename=\"' . $filename . '\"');\n-    header('Cache-Control: max-age=0');\n-\n-    $writer = new \\PhpOffice\\PhpSpreadsheet\\Writer\\Csv($spreadsheet);\n-    $writer->save('php://output');\n-    exit;\n-}\n-public function exportExcel()\n-{\n-    $transactions = $this->recentTransactions() ?? [];\n-    $budgetData = [\n-        'Overall Budget' => $this->overAllBudget() ?? 0,\n-        'Total Grants Released' => $this->totalGrantsReleased() ?? 0,\n-        'Budget Utilization (%)' => $this->budgetUtilization() ?? 0,\n-        'Pending Disbursements' => $this->pendingDisbursements() ?? 0\n+    $headers = [\n+        'Content-Type' => 'text/csv',\n+        'Content-Disposition' => \"attachment; filename=\\\"$filename\\\"\",\n     ];\n \n-    $spreadsheet = new Spreadsheet();\n-    $sheet = $spreadsheet->getActiveSheet();\n+    $callback = function() use ($totalGrantsReleased, $combinedTotalValue, $budgetUtilization, $pendingDisbursements, $transactions) {\n+        $file = fopen('php://output', 'w');\n \n-    $row = 1;\n+        // Title\n+        fputcsv($file, ['SwisaAGAP Financial Report']);\n+        fputcsv($file, []);\n \n-    // Budget Summary\n-    $sheet->setCellValue('A' . $row, 'Financial Summary');\n-    $row++;\n-    foreach ($budgetData as $key => $value) {\n-        $sheet->setCellValue('A' . $row, $key);\n-        $sheet->setCellValue('B' . $row, $value);\n-        $row++;\n-    }\n+        // Summary\n+        fputcsv($file, ['Overall Budget', 'â‚± ' . number_format($combinedTotalValue,2)]);\n+        fputcsv($file, ['Total Grants Released', 'â‚± ' . number_format($totalGrantsReleased,2)]);\n+        fputcsv($file, ['Budget Utilization', $budgetUtilization . '%']);\n+        fputcsv($file, ['Pending Disbursements', 'â‚± ' . number_format($pendingDisbursements,2)]);\n+        fputcsv($file, []);\n \n-    $row++; // empty row\n+        // Transactions\n+        fputcsv($file, ['Recent Financial Transactions']);\n+        fputcsv($file, ['Transaction ID', 'Type', 'Amount', 'Date', 'Status']);\n+        foreach ($transactions as $t) {\n+            fputcsv($file, [\n+                $t['transaction_id'],\n+                $t['type'],\n+                'â‚± ' . number_format($t['amount'], 2),\n+                $t['date'],\n+                $t['status']\n+            ]);\n+        }\n \n-    // Transactions Header\n-    $sheet->setCellValue('A' . $row, 'Transaction ID');\n-    $sheet->setCellValue('B' . $row, 'Type');\n-    $sheet->setCellValue('C' . $row, 'Amount');\n-    $sheet->setCellValue('D' . $row, 'Date');\n-    $sheet->setCellValue('E' . $row, 'Status');\n-    $row++;\n+        fputcsv($file, []);\n+        fputcsv($file, ['Latest as of ' . now()->format('F d, Y')]);\n+        fclose($file);\n+    };\n \n-    // Transactions Data\n-    foreach ($transactions as $t) {\n-        $sheet->setCellValue('A' . $row, $t['transaction_id']);\n-        $sheet->setCellValue('B' . $row, $t['type']);\n-        $sheet->setCellValue('C' . $row, $t['amount']);\n-        $sheet->setCellValue('D' . $row, $t['date']);\n-        $sheet->setCellValue('E' . $row, $t['status']);\n-        $row++;\n-    }\n-\n-    // Auto size columns\n-    foreach (range('A', 'E') as $col) {\n-        $sheet->getColumnDimension($col)->setAutoSize(true);\n-    }\n-\n-    $filename = 'swisa_financial_report_' . now()->format('Ymd_His') . '.xlsx';\n-\n-    header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n-    header('Content-Disposition: attachment;filename=\"' . $filename . '\"');\n-    header('Cache-Control: max-age=0');\n-\n-    $writer = new Xlsx($spreadsheet);\n-    $writer->save('php://output');\n-    exit;\n+    return Response::stream($callback, 200, $headers);\n }\n \n }\n"
                },
                {
                    "date": 1764349358835,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -320,6 +320,66 @@\n     };\n \n     return Response::stream($callback, 200, $headers);\n }\n+public function exportFinancialExcel()\n+{\n+    $totalGrantsReleased = $this->totalGrantsReleased() ?? 0;\n+    $combinedTotalValue = $this->overAllBudget() ?? 0;\n+    $budgetUtilization = $this->budgetUtilization() ?? 0;\n+    $pendingDisbursements = $this->pendingDisbursements() ?? 0;\n+    $transactions = $this->recentTransactions() ?? [];\n \n+    $spreadsheet = new Spreadsheet();\n+    $sheet = $spreadsheet->getActiveSheet();\n+    $row = 1;\n+\n+    // Title\n+    $sheet->setCellValue('A' . $row++, 'SwisaAGAP Financial Report');\n+    $row++; // blank row\n+\n+    // Summary\n+    $sheet->setCellValue('A' . $row, 'Overall Budget');\n+    $sheet->setCellValue('B' . $row++, 'â‚± ' . number_format($combinedTotalValue,2));\n+\n+    $sheet->setCellValue('A' . $row, 'Total Grants Released');\n+    $sheet->setCellValue('B' . $row++, 'â‚± ' . number_format($totalGrantsReleased,2));\n+\n+    $sheet->setCellValue('A' . $row, 'Budget Utilization');\n+    $sheet->setCellValue('B' . $row++, $budgetUtilization . '%');\n+\n+    $sheet->setCellValue('A' . $row, 'Pending Disbursements');\n+    $sheet->setCellValue('B' . $row++, 'â‚± ' . number_format($pendingDisbursements,2));\n+\n+    $row++; // blank row\n+\n+    // Transactions\n+    $sheet->setCellValue('A' . $row++, 'Recent Financial Transactions');\n+    $sheet->fromArray([\n+        ['Transaction ID', 'Type', 'Amount', 'Date', 'Status']\n+    ], null, 'A' . $row++);\n+\n+    foreach ($transactions as $t) {\n+        $sheet->fromArray([\n+            $t['transaction_id'],\n+            $t['type'],\n+            'â‚± ' . number_format($t['amount'], 2),\n+            $t['date'],\n+            $t['status']\n+        ], null, 'A' . $row++);\n+    }\n+\n+    $row++; // blank row\n+    $sheet->setCellValue('A' . $row, 'Latest as of ' . now()->format('F d, Y'));\n+\n+    // Output Excel\n+    $filename = 'swisa_financial_report_' . now()->format('Ymd_His') . '.xlsx';\n+    header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n+    header(\"Content-Disposition: attachment; filename=\\\"$filename\\\"\");\n+    header('Cache-Control: max-age=0');\n+\n+    $writer = new Xlsx($spreadsheet);\n+    $writer->save('php://output');\n+    exit;\n }\n+\n+}\n"
                }
            ],
            "date": 1764318797199,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\DB;\nuse App\\Models\\ReportFinancial;\n\nclass ReportFinancialController extends Controller\n{\n    public function index()\n    {\n        // Calculate Total Grants Released\n        $totalGrantsReleased = DB::table('applications as a')\n            ->join('grants as g', 'a.grant_id', '=', 'g.id')\n            ->where('a.status_id', 2) // assuming 2 = released\n            ->sum(DB::raw('a.total_quantity * g.amount_per_quantity'));\n\n        // Format to PHP number format with 2 decimals\n        $formattedTotal = number_format($totalGrantsReleased, 2);\n\n        // Pass to the view\n        return view('swisa-admin.admin-reports.financial', compact('formattedTotal'));\n    }\n}\n"
        }
    ]
}