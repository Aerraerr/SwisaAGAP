{
    "sourceFile": "app/Http/Controllers/ReportFeedbackController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1764156985465,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764157013092,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,13 +6,16 @@\n use App\\Models\\Feedback;\r\n \r\n class FeedbackReportController extends Controller\r\n {\r\n+    // Display all feedbacks in the reports page\r\n     public function index()\r\n     {\r\n-        // Get all feedbacks with user info\r\n-        $feedbacks = Feedback::with('user')->latest()->get();\r\n+        // Fetch all feedbacks with related user info\r\n+        $feedbacks = Feedback::with('user')\r\n+            ->orderBy('created_at', 'desc')\r\n+            ->get();\r\n \r\n-        // Pass it to your blade\r\n-        return view('swisa-admin.admin-reports.report', compact('feedbacks'));\r\n+        // Pass the feedbacks to the report blade\r\n+        return view('swisa-admin.admin-reports.feedback', compact('feedbacks'));\r\n     }\r\n }\r\n"
                },
                {
                    "date": 1764162996774,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,21 +1,21 @@\n <?php\r\n \r\n namespace App\\Http\\Controllers;\r\n \r\n-use App\\Http\\Controllers\\Controller;\r\n-use App\\Models\\Feedback;\r\n+use Illuminate\\Http\\Request;\r\n+use App\\Models\\ReportFeedback;\r\n \r\n-class FeedbackReportController extends Controller\r\n+class ReportFeedbackController extends Controller\r\n {\r\n     // Display all feedbacks in the reports page\r\n     public function index()\r\n     {\r\n-        // Fetch all feedbacks with related user info\r\n-        $feedbacks = Feedback::with('user')\r\n+        // Fetch all feedbacks with related user info, newest first\r\n+        $feedbacks = ReportFeedback::with('user')\r\n             ->orderBy('created_at', 'desc')\r\n             ->get();\r\n \r\n-        // Pass the feedbacks to the report blade\r\n-        return view('swisa-admin.admin-reports.feedback', compact('feedbacks'));\r\n+        // Pass feedbacks to the report blade\r\n+        return view('swisa-admin.admin-reports.report', compact('feedbacks'));\r\n     }\r\n }\r\n"
                },
                {
                    "date": 1764164550054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,21 +1,26 @@\n-<?php\r\n-\r\n-namespace App\\Http\\Controllers;\r\n-\r\n-use Illuminate\\Http\\Request;\r\n-use App\\Models\\ReportFeedback;\r\n-\r\n-class ReportFeedbackController extends Controller\r\n-{\r\n-    // Display all feedbacks in the reports page\r\n-    public function index()\r\n-    {\r\n-        // Fetch all feedbacks with related user info, newest first\r\n-        $feedbacks = ReportFeedback::with('user')\r\n-            ->orderBy('created_at', 'desc')\r\n-            ->get();\r\n-\r\n-        // Pass feedbacks to the report blade\r\n-        return view('swisa-admin.admin-reports.report', compact('feedbacks'));\r\n-    }\r\n-}\r\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use Illuminate\\Http\\Request;\n+use App\\Models\\ReportFeedback;\n+\n+class ReportFeedbackController extends Controller\n+{\n+    /**\n+     * Display a listing of the feedback for reports page.\n+     */\n+    public function index(Request $request)\n+    {\n+        // optional: add filtering, date range, category etc. later\n+        $feedbacks = ReportFeedback::with('user')\n+            ->orderBy('created_at', 'desc')\n+            ->get();\n+\n+        // return the reports view and pass the feedback collection\n+        // adjust the view path if your reports.blade.php is in another location\n+        return view('swisa-admin.admin-reports.reports', compact('feedbacks'));\n+    }\n+\n+    // other resource methods (show, destroy, etc.) can be added later if needed\n+}\n"
                },
                {
                    "date": 1764182248774,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,26 +1,83 @@\n <?php\n \n-namespace App\\Http\\Controllers;\n+namespace App\\Http\\Controllers\\Web;\n \n+use App\\Http\\Controllers\\Controller;\n+use App\\Models\\Feedback;\n use Illuminate\\Http\\Request;\n-use App\\Models\\ReportFeedback;\n \n class ReportFeedbackController extends Controller\n {\n-    /**\n-     * Display a listing of the feedback for reports page.\n-     */\n-    public function index(Request $request)\n+    public function index()\n     {\n-        // optional: add filtering, date range, category etc. later\n-        $feedbacks = ReportFeedback::with('user')\n-            ->orderBy('created_at', 'desc')\n-            ->get();\n+        // Fetch all feedback with user relation\n+        $feedbacks = Feedback::with('user')->latest()->get();\n \n-        // return the reports view and pass the feedback collection\n-        // adjust the view path if your reports.blade.php is in another location\n-        return view('swisa-admin.admin-reports.reports', compact('feedbacks'));\n+        // -----------------------------\n+        // 1. RATING SUMMARY\n+        // -----------------------------\n+        $totalRatings = $feedbacks->whereNotNull('rating')->count();\n+        $averageRating = $feedbacks->avg('rating') ?? 0;\n+\n+        // Rating breakdown (1–5)\n+        $ratingBreakdown = [\n+            5 => $feedbacks->where('rating', 5)->count(),\n+            4 => $feedbacks->where('rating', 4)->count(),\n+            3 => $feedbacks->where('rating', 3)->count(),\n+            2 => $feedbacks->where('rating', 2)->count(),\n+            1 => $feedbacks->where('rating', 1)->count(),\n+        ];\n+\n+        // -----------------------------\n+        // 2. CUSTOMER LIKE & IMPROVEMENTS\n+        // (auto-detect based on keywords)\n+        // -----------------------------\n+        $positiveTags = [\n+            'fun' => 'Fun Factor',\n+            'value' => 'Great Value',\n+            'teacher' => 'Teachers',\n+            'clean' => 'Clean Facility',\n+            'organized' => 'Well Organized'\n+        ];\n+\n+        $negativeTags = [\n+            'expensive' => 'Value for Money',\n+            'busy' => 'Too Busy',\n+            'crowded' => 'Crowded',\n+            'age' => 'Age Appropriate',\n+            'noise' => 'Too Noisy'\n+        ];\n+\n+        $likesCount = [];\n+        $improveCount = [];\n+\n+        foreach ($feedbacks as $fb) {\n+            $text = strtolower($fb->feedback ?? '');\n+\n+            foreach ($positiveTags as $key => $label) {\n+                if (str_contains($text, $key)) {\n+                    $likesCount[$label] = ($likesCount[$label] ?? 0) + 1;\n+                }\n+            }\n+\n+            foreach ($negativeTags as $key => $label) {\n+                if (str_contains($text, $key)) {\n+                    $improveCount[$label] = ($improveCount[$label] ?? 0) + 1;\n+                }\n+            }\n+        }\n+\n+        // Sort by highest votes\n+        arsort($likesCount);\n+        arsort($improveCount);\n+\n+        return view('admin.reports.feedback', [\n+            'feedbacks'        => $feedbacks,\n+            'averageRating'    => round($averageRating, 2),\n+            'ratingBreakdown'  => $ratingBreakdown,\n+            'totalRatings'     => $totalRatings,\n+            'likesCount'       => $likesCount,\n+            'improveCount'     => $improveCount,\n+        ]);\n     }\n-\n-    // other resource methods (show, destroy, etc.) can be added later if needed\n }\n"
                },
                {
                    "date": 1764182693641,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,83 +1,85 @@\n <?php\n \n namespace App\\Http\\Controllers;\n \n-use App\\Http\\Controllers\\Controller;\n use App\\Models\\Feedback;\n-use Illuminate\\Http\\Request;\n+use Carbon\\Carbon;\n \n class ReportFeedbackController extends Controller\n {\n     public function index()\n     {\n         // Fetch all feedback with user relation\n         $feedbacks = Feedback::with('user')->latest()->get();\n \n-        // -----------------------------\n-        // 1. RATING SUMMARY\n-        // -----------------------------\n+        // ----------------------------------------------------\n+        // 1. SUMMARY (AVG rating + total reviews)\n+        // ----------------------------------------------------\n         $totalRatings = $feedbacks->whereNotNull('rating')->count();\n         $averageRating = $feedbacks->avg('rating') ?? 0;\n \n-        // Rating breakdown (1–5)\n+        // ----------------------------------------------------\n+        // 2. STAR BREAKDOWN (5 → 1)\n+        // ----------------------------------------------------\n         $ratingBreakdown = [\n             5 => $feedbacks->where('rating', 5)->count(),\n             4 => $feedbacks->where('rating', 4)->count(),\n             3 => $feedbacks->where('rating', 3)->count(),\n             2 => $feedbacks->where('rating', 2)->count(),\n             1 => $feedbacks->where('rating', 1)->count(),\n         ];\n \n-        // -----------------------------\n-        // 2. CUSTOMER LIKE & IMPROVEMENTS\n-        // (auto-detect based on keywords)\n-        // -----------------------------\n-        $positiveTags = [\n+        // ----------------------------------------------------\n+        // 3. WHAT CUSTOMERS LIKE (detected by keywords)\n+        // ----------------------------------------------------\n+        $positiveKeywords = [\n             'fun' => 'Fun Factor',\n             'value' => 'Great Value',\n             'teacher' => 'Teachers',\n             'clean' => 'Clean Facility',\n-            'organized' => 'Well Organized'\n+            'organized' => 'Well Organized',\n         ];\n \n-        $negativeTags = [\n+        $negativeKeywords = [\n             'expensive' => 'Value for Money',\n             'busy' => 'Too Busy',\n+            'age' => 'Age Appropriate',\n+            'noise' => 'Too Noisy',\n             'crowded' => 'Crowded',\n-            'age' => 'Age Appropriate',\n-            'noise' => 'Too Noisy'\n         ];\n \n-        $likesCount = [];\n-        $improveCount = [];\n+        $likes = [];\n+        $improvements = [];\n \n         foreach ($feedbacks as $fb) {\n             $text = strtolower($fb->feedback ?? '');\n \n-            foreach ($positiveTags as $key => $label) {\n-                if (str_contains($text, $key)) {\n-                    $likesCount[$label] = ($likesCount[$label] ?? 0) + 1;\n+            foreach ($positiveKeywords as $word => $label) {\n+                if (str_contains($text, $word)) {\n+                    $likes[$label] = ($likes[$label] ?? 0) + 1;\n                 }\n             }\n \n-            foreach ($negativeTags as $key => $label) {\n-                if (str_contains($text, $key)) {\n-                    $improveCount[$label] = ($improveCount[$label] ?? 0) + 1;\n+            foreach ($negativeKeywords as $word => $label) {\n+                if (str_contains($text, $word)) {\n+                    $improvements[$label] = ($improvements[$label] ?? 0) + 1;\n                 }\n             }\n         }\n \n-        // Sort by highest votes\n-        arsort($likesCount);\n-        arsort($improveCount);\n+        arsort($likes);\n+        arsort($improvements);\n \n+        // ----------------------------------------------------\n+        // 4. Pass to view\n+        // ----------------------------------------------------\n         return view('admin.reports.feedback', [\n             'feedbacks'        => $feedbacks,\n             'averageRating'    => round($averageRating, 2),\n+            'totalRatings'     => $totalRatings,\n             'ratingBreakdown'  => $ratingBreakdown,\n-            'totalRatings'     => $totalRatings,\n-            'likesCount'       => $likesCount,\n-            'improveCount'     => $improveCount,\n+            'likes'            => $likes,\n+            'improvements'     => $improvements,\n         ]);\n     }\n }\n"
                },
                {
                    "date": 1764182974883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,35 @@\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use App\\Models\\Feedback;\n+use App\\Models\\User;\n+\n+class ReportFeedbackController extends Controller\n+{\n+    public function index()\n+    {\n+        // Get all feedback with user relation\n+        $feedback = Feedback::with('user')\n+            ->orderByDesc('created_at')\n+            ->get()\n+            ->map(function ($item) {\n+                return [\n+                    'id'        => $item->id,\n+                    'user_name' => $item->user ? $item->user->name : 'Anonymous User',\n+                    'rating'    => $item->rating ?? 0,\n+                    'feedback'  => $item->feedback ?? '',\n+                    'date'      => $item->created_at->format('M d, Y'),\n+                ];\n+            });\n+\n+        // Overall rating percentage (if needed)\n+        $averageRating = Feedback::avg('rating');\n+        $ratingPercent = $averageRating ? round(($averageRating / 5) * 100) : 0;\n+\n+        return view('reports', [\n+            'feedbackList'  => $feedback,\n+            'ratingPercent' => $ratingPercent,\n+        ]);\n+    }\n+}\n"
                }
            ],
            "date": 1764156985465,
            "name": "Commit-0",
            "content": "<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse App\\Http\\Controllers\\Controller;\r\nuse App\\Models\\Feedback;\r\n\r\nclass FeedbackReportController extends Controller\r\n{\r\n    public function index()\r\n    {\r\n        // Get all feedbacks with user info\r\n        $feedbacks = Feedback::with('user')->latest()->get();\r\n\r\n        // Pass it to your blade\r\n        return view('swisa-admin.admin-reports.report', compact('feedbacks'));\r\n    }\r\n}\r\n"
        }
    ]
}