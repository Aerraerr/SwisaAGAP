{
    "sourceFile": "app/Models/User.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 28,
            "patches": [
                {
                    "date": 1763817552348,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763817818315,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,14 +93,12 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-public function trainings()\n-{\n-    return $this->belongsToMany(Training::class, 'participants')\n-                ->withPivot('qr_scanned', 'check_in_at')\n-                ->withTimestamps();\n-}\n+    public function trainings()\n+    {\n+        return $this->hasMany(Training::class, 'participants');\n+    }\n \n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n"
                },
                {
                    "date": 1763817882577,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,13 +93,16 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->hasMany(Training::class, 'participants');\n-    }\n+public function trainings()\n+{\n+    return $this->belongsToMany(Training::class, 'training_participants')\n+                ->withPivot(['qr_scanned', 'check_in_at'])\n+                ->withTimestamps();\n+}\n \n+\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n"
                },
                {
                    "date": 1763818123219,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,16 +93,13 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-public function trainings()\n-{\n-    return $this->belongsToMany(Training::class, 'training_participants')\n-                ->withPivot(['qr_scanned', 'check_in_at'])\n-                ->withTimestamps();\n-}\n+    public function trainings()\n+    {\n+        return $this->hasMany(Training::class, 'participants');\n+    }\n \n-\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n"
                },
                {
                    "date": 1763818149545,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,13 +93,16 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->hasMany(Training::class, 'participants');\n-    }\n+public function trainings()\n+{\n+    return $this->belongsToMany(Training::class, 'training_participants')\n+                ->withPivot(['qr_scanned', 'check_in_at'])\n+                ->withTimestamps();\n+}\n \n+\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n"
                },
                {
                    "date": 1763818676246,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,14 +95,15 @@\n     }\n \n public function trainings()\n {\n-    return $this->belongsToMany(Training::class, 'training_participants')\n+    return $this->belongsToMany(Training::class, 'participants', 'user_id', 'training_id')\n                 ->withPivot(['qr_scanned', 'check_in_at'])\n                 ->withTimestamps();\n }\n \n \n+\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n"
                },
                {
                    "date": 1763821023630,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,17 +93,13 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-public function trainings()\n-{\n-    return $this->belongsToMany(Training::class, 'participants', 'user_id', 'training_id')\n-                ->withPivot(['qr_scanned', 'check_in_at'])\n-                ->withTimestamps();\n-}\n+    public function trainings()\n+    {\n+        return $this->hasMany(Training::class, 'participants');\n+    }\n \n-\n-\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n"
                },
                {
                    "date": 1763821480279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,13 +93,14 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->hasMany(Training::class, 'participants');\n-    }\n+public function trainings()\n+{\n+    return $this->hasMany(Training::class, 'participants');\n+}\n \n+\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n@@ -145,5 +146,8 @@\n         ]);\n \n         return $newScore;\n     }\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    }\n }\n"
                },
                {
                    "date": 1763821488959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,9 +95,11 @@\n     }\n \n public function trainings()\n {\n-    return $this->hasMany(Training::class, 'participants');\n+    return $this->belongsToMany(Training::class, 'participants')\n+                ->withPivot('qr_scanned', 'check_in_at')\n+                ->withTimestamps();\n }\n \n \n     public function notifications()\n"
                },
                {
                    "date": 1763822168914,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,8 +26,9 @@\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n+        'name', // alion nalang pag okay na\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n"
                },
                {
                    "date": 1763822257571,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,8 @@\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name', // alion nalang pag okay na\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n"
                },
                {
                    "date": 1763822265636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -151,5 +151,10 @@\n     }\n     public function getFormattedIdAttribute(){\n         return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n+    public function getNameAttribute()\n+{\n+    return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n }\n+\n+}\n"
                },
                {
                    "date": 1763823286480,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,8 +26,9 @@\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n+        'name',\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n"
                },
                {
                    "date": 1763832235106,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,8 @@\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name',\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n@@ -94,16 +93,13 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-public function trainings()\n-{\n-    return $this->belongsToMany(Training::class, 'participants')\n-                ->withPivot('qr_scanned', 'check_in_at')\n-                ->withTimestamps();\n-}\n+    public function trainings()\n+    {\n+        return $this->hasMany(Training::class, 'participants');\n+    }\n \n-\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n@@ -149,13 +145,5 @@\n         ]);\n \n         return $newScore;\n     }\n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n-    }\n-    public function getNameAttribute()\n-{\n-    return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n }\n-\n-}\n"
                },
                {
                    "date": 1763832241097,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,8 +26,9 @@\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n+        'name',\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n@@ -93,13 +94,16 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->hasMany(Training::class, 'participants');\n-    }\n+public function trainings()\n+{\n+    return $this->belongsToMany(Training::class, 'participants')\n+                ->withPivot('qr_scanned', 'check_in_at')\n+                ->withTimestamps();\n+}\n \n+\n     public function notifications()\n     {\n         return $this->hasMany(Notification::class);\n     }\n@@ -145,5 +149,13 @@\n         ]);\n \n         return $newScore;\n     }\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    }\n+    public function getNameAttribute()\n+{\n+    return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n }\n+\n+}\n"
                },
                {
                    "date": 1763865945217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n     public function getFormattedIdAttribute(){\n         return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n     public function getNameAttribute()\n-{\n-    return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n-}\n+    {\n+        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n+    }\n \n }\n"
                },
                {
                    "date": 1764144685927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,14 +94,14 @@\n     {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-public function trainings()\n-{\n-    return $this->belongsToMany(Training::class, 'participants')\n-                ->withPivot('qr_scanned', 'check_in_at')\n-                ->withTimestamps();\n-}\n+    public function trainings()\n+    {\n+        return $this->belongsToMany(Training::class, 'participants')\n+                    ->withPivot('qr_scanned', 'check_in_at')\n+                    ->withTimestamps();\n+    }\n \n \n     public function notifications()\n     {\n"
                },
                {
                    "date": 1764940056950,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,51 @@\n+\n <?php\n \n namespace App\\Models;\n \n+use Illuminate\\Contracts\\Auth\\MustVerifyEmail;\n use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n use Illuminate\\Foundation\\Auth\\User as Authenticatable;\n use Illuminate\\Notifications\\Notifiable;\n-use Laravel\\Sanctum\\HasApiTokens;\n+\n use App\\Models\\Role;\n use App\\Models\\Application;\n use App\\Models\\Document;\n use App\\Models\\Notification;\n use App\\Models\\Training;\n use App\\Models\\UserInfo;\n+use Laravel\\Sanctum\\HasApiTokens;\n use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n+use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable\n+class User extends Authenticatable implements MustVerifyEmail\n {\n-    use HasFactory, Notifiable, HasApiTokens;\n+    use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n      * The attributes that are mass assignable.\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name',\n+        'name', // alion nalang pag okay na\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n         'email',\n         'password',\n         'phone_number',\n         'mpin',\n+        'qr_code',\n+        'login_method',\n         'role_id',\n+        'email_verified_at',\n+        'phone_verified_at',\n     ];\n \n     /**\n      * The attributes that should be hidden for serialization.\n@@ -49,66 +57,62 @@\n         'mpin',\n         'remember_token',\n     ];\n \n-    /* Get the attributes that should be cast.\n-\n+    /**\n+     * Get the attributes that should be cast.\n+     *\n      * @return array<string, string>\n      */\n     protected function casts(): array\n     {\n         return [\n             'email_verified_at' => 'datetime',\n+             'phone_verified_at' => 'datetime',\n             'password' => 'hashed',\n         ];\n     }\n \n-    /*Boot method - automatically create credit score when user is created*/\n-    protected static function booted()\n-    {\n-        static::created(function ($user) {\n-            CreditScore::create([\n-                'user_id' => $user->id,\n-                'score' => 20\n-            ]);\n-        });\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n \n-    // --- Relationships ---\n+    //RELATIONSHIP TO USERS\\\n \n-    public function role()\n-    {\n+    //for role: each user belongs to a role (1:1)\n+    public function role(){\n         return $this->belongsTo(Role::class);\n     }\n \n-    public function userInfo(): HasOne\n-    {\n+    //for user_info: sa web\n+    public function user_info(){\n         return $this->hasOne(UserInfo::class);\n     }\n \n-    public function applications()\n-    {\n+    //for user_info: sa mobile ini\n+    public function userInfo(){\n+        return $this->hasOne(UserInfo::class);\n+    }\n+\n+    //for applications: a user can submit many applications (1:M)\n+    public function applications(){\n         return $this->hasMany(Application::class);\n     }\n \n-    public function documents()\n-    {\n+    //for documents: a user can upload many documents (polymorphic relation)\n+    public function documents(){\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->belongsToMany(Training::class, 'participants')\n-                    ->withPivot('qr_scanned', 'check_in_at')\n-                    ->withTimestamps();\n+    //for trainings: a user can attend many trainings\n+    public function trainings(){\n+        return $this->hasMany(Training::class, 'participants');\n     }\n \n-\n-    public function notifications()\n-    {\n+    //for notifications: a user can have many notifications\n+    public function notifications(){\n         return $this->hasMany(Notification::class);\n     }\n-\n     /**\n      * Get the credit score for the user.\n      */\n     public function creditScore(): HasOne\n@@ -123,39 +127,83 @@\n     {\n         return $this->hasMany(CreditScoreHistory::class)->latest();\n     }\n \n-     /*Adjust the user's credit score and log it in history*/\n-    public function adjustCreditScore(int $points, string $activity)\n+    /**\n+     * Get phone OTP records for this user\n+     */\n+    public function phoneOtps()\n     {\n-        // Get or create credit score\n-        $creditScore = $this->creditScore()->firstOrCreate(\n-            ['user_id' => $this->id],\n-            ['score' => 20]\n-        );\n+        return $this->hasMany(PhoneOtp::class, 'phone_number', 'phone_number');\n+    }\n \n-        // Update the score\n-        $newScore = $creditScore->score + $points;\n-        \n-        // Don't let score go below 0\n-        $newScore = max(0, $newScore);\n-        \n-        $creditScore->update(['score' => $newScore]);\n+    /**\n+     * Get latest phone OTP\n+     */\n+    public function latestPhoneOtp()\n+    {\n+        return $this->hasOne(PhoneOtp::class, 'phone_number', 'phone_number')\n+            ->latestOfMany();\n+    }\n \n-        // Log in history\n-        CreditScoreHistory::create([\n-            'user_id' => $this->id,\n-            'activity' => $activity,\n-            'points' => $points,\n-        ]);\n+    /**\n+     * Check if user's phone is verified\n+     */\n+    public function isPhoneVerified(): bool\n+    {\n+        return $this->phone_verified_at !== null;\n+    }\n \n-        return $newScore;\n+    /**\n+     * Check if user's email is verified\n+     */\n+    public function isEmailVerified(): bool\n+    {\n+        return $this->email_verified_at !== null;\n     }\n+\n+    /**\n+     * Get user's full name\n+     */\n+    public function getFullNameAttribute(): string\n+    {\n+        $name = trim(\"{$this->first_name} {$this->middle_name} {$this->last_name}\");\n+        if ($this->suffix && $this->suffix !== 'N/A') {\n+            $name .= \" {$this->suffix}\";\n+        }\n+        return $name;\n+    }\n+\n+    /**\n+     * Get user's identifier (email or phone)\n+     */\n+    public function getIdentifierAttribute(): string\n+    {\n+        return $this->email ?? $this->phone_number ?? 'Unknown';\n+    }\n+\n+    /**\n+     * Check if user registered with email\n+     */\n+    public function isEmailUser(): bool\n+    {\n+        return $this->login_method === 'email' || !empty($this->email);\n+    }\n+\n+    /**\n+     * Check if user registered with phone\n+     */\n+    public function isPhoneUser(): bool\n+    {\n+        return $this->login_method === 'phone' || !empty($this->phone_number);\n+    }\n+    \n+\n     public function getFormattedIdAttribute(){\n         return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n     public function getNameAttribute()\n     {\n         return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n     }\n+}\n \n-}\n"
                },
                {
                    "date": 1764940085020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,51 +1,43 @@\n-\n <?php\n \n namespace App\\Models;\n \n-use Illuminate\\Contracts\\Auth\\MustVerifyEmail;\n use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n use Illuminate\\Foundation\\Auth\\User as Authenticatable;\n use Illuminate\\Notifications\\Notifiable;\n-\n+use Laravel\\Sanctum\\HasApiTokens;\n use App\\Models\\Role;\n use App\\Models\\Application;\n use App\\Models\\Document;\n use App\\Models\\Notification;\n use App\\Models\\Training;\n use App\\Models\\UserInfo;\n-use Laravel\\Sanctum\\HasApiTokens;\n use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n-use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable implements MustVerifyEmail\n+class User extends Authenticatable\n {\n-    use HasFactory, HasApiTokens, Notifiable;\n+    use HasFactory, Notifiable, HasApiTokens;\n \n     /**\n      * The attributes that are mass assignable.\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name', // alion nalang pag okay na\n+        'name',\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n         'email',\n         'password',\n         'phone_number',\n         'mpin',\n-        'qr_code',\n-        'login_method',\n         'role_id',\n-        'email_verified_at',\n-        'phone_verified_at',\n     ];\n \n     /**\n      * The attributes that should be hidden for serialization.\n@@ -57,62 +49,66 @@\n         'mpin',\n         'remember_token',\n     ];\n \n-    /**\n-     * Get the attributes that should be cast.\n-     *\n+    /* Get the attributes that should be cast.\n+\n      * @return array<string, string>\n      */\n     protected function casts(): array\n     {\n         return [\n             'email_verified_at' => 'datetime',\n-             'phone_verified_at' => 'datetime',\n             'password' => 'hashed',\n         ];\n     }\n \n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    /*Boot method - automatically create credit score when user is created*/\n+    protected static function booted()\n+    {\n+        static::created(function ($user) {\n+            CreditScore::create([\n+                'user_id' => $user->id,\n+                'score' => 20\n+            ]);\n+        });\n     }\n \n-    //RELATIONSHIP TO USERS\\\n+    // --- Relationships ---\n \n-    //for role: each user belongs to a role (1:1)\n-    public function role(){\n+    public function role()\n+    {\n         return $this->belongsTo(Role::class);\n     }\n \n-    //for user_info: sa web\n-    public function user_info(){\n+    public function userInfo(): HasOne\n+    {\n         return $this->hasOne(UserInfo::class);\n     }\n \n-    //for user_info: sa mobile ini\n-    public function userInfo(){\n-        return $this->hasOne(UserInfo::class);\n-    }\n-\n-    //for applications: a user can submit many applications (1:M)\n-    public function applications(){\n+    public function applications()\n+    {\n         return $this->hasMany(Application::class);\n     }\n \n-    //for documents: a user can upload many documents (polymorphic relation)\n-    public function documents(){\n+    public function documents()\n+    {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    //for trainings: a user can attend many trainings\n-    public function trainings(){\n-        return $this->hasMany(Training::class, 'participants');\n+    public function trainings()\n+    {\n+        return $this->belongsToMany(Training::class, 'participants')\n+                    ->withPivot('qr_scanned', 'check_in_at')\n+                    ->withTimestamps();\n     }\n \n-    //for notifications: a user can have many notifications\n-    public function notifications(){\n+\n+    public function notifications()\n+    {\n         return $this->hasMany(Notification::class);\n     }\n+\n     /**\n      * Get the credit score for the user.\n      */\n     public function creditScore(): HasOne\n@@ -127,83 +123,39 @@\n     {\n         return $this->hasMany(CreditScoreHistory::class)->latest();\n     }\n \n-    /**\n-     * Get phone OTP records for this user\n-     */\n-    public function phoneOtps()\n+     /*Adjust the user's credit score and log it in history*/\n+    public function adjustCreditScore(int $points, string $activity)\n     {\n-        return $this->hasMany(PhoneOtp::class, 'phone_number', 'phone_number');\n-    }\n+        // Get or create credit score\n+        $creditScore = $this->creditScore()->firstOrCreate(\n+            ['user_id' => $this->id],\n+            ['score' => 20]\n+        );\n \n-    /**\n-     * Get latest phone OTP\n-     */\n-    public function latestPhoneOtp()\n-    {\n-        return $this->hasOne(PhoneOtp::class, 'phone_number', 'phone_number')\n-            ->latestOfMany();\n-    }\n+        // Update the score\n+        $newScore = $creditScore->score + $points;\n+        \n+        // Don't let score go below 0\n+        $newScore = max(0, $newScore);\n+        \n+        $creditScore->update(['score' => $newScore]);\n \n-    /**\n-     * Check if user's phone is verified\n-     */\n-    public function isPhoneVerified(): bool\n-    {\n-        return $this->phone_verified_at !== null;\n-    }\n+        // Log in history\n+        CreditScoreHistory::create([\n+            'user_id' => $this->id,\n+            'activity' => $activity,\n+            'points' => $points,\n+        ]);\n \n-    /**\n-     * Check if user's email is verified\n-     */\n-    public function isEmailVerified(): bool\n-    {\n-        return $this->email_verified_at !== null;\n+        return $newScore;\n     }\n-\n-    /**\n-     * Get user's full name\n-     */\n-    public function getFullNameAttribute(): string\n-    {\n-        $name = trim(\"{$this->first_name} {$this->middle_name} {$this->last_name}\");\n-        if ($this->suffix && $this->suffix !== 'N/A') {\n-            $name .= \" {$this->suffix}\";\n-        }\n-        return $name;\n-    }\n-\n-    /**\n-     * Get user's identifier (email or phone)\n-     */\n-    public function getIdentifierAttribute(): string\n-    {\n-        return $this->email ?? $this->phone_number ?? 'Unknown';\n-    }\n-\n-    /**\n-     * Check if user registered with email\n-     */\n-    public function isEmailUser(): bool\n-    {\n-        return $this->login_method === 'email' || !empty($this->email);\n-    }\n-\n-    /**\n-     * Check if user registered with phone\n-     */\n-    public function isPhoneUser(): bool\n-    {\n-        return $this->login_method === 'phone' || !empty($this->phone_number);\n-    }\n-    \n-\n     public function getFormattedIdAttribute(){\n         return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n     public function getNameAttribute()\n     {\n         return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n     }\n+\n }\n-\n"
                },
                {
                    "date": 1764940147696,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,50 @@\n <?php\n \n namespace App\\Models;\n \n+use Illuminate\\Contracts\\Auth\\MustVerifyEmail;\n use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n use Illuminate\\Foundation\\Auth\\User as Authenticatable;\n use Illuminate\\Notifications\\Notifiable;\n-use Laravel\\Sanctum\\HasApiTokens;\n+\n use App\\Models\\Role;\n use App\\Models\\Application;\n use App\\Models\\Document;\n use App\\Models\\Notification;\n use App\\Models\\Training;\n use App\\Models\\UserInfo;\n+use Laravel\\Sanctum\\HasApiTokens;\n use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n+use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable\n+class User extends Authenticatable implements MustVerifyEmail\n {\n-    use HasFactory, Notifiable, HasApiTokens;\n+    use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n      * The attributes that are mass assignable.\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name',\n+        'name', // alion nalang pag okay na\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n         'email',\n         'password',\n         'phone_number',\n         'mpin',\n+        'qr_code',\n+        'login_method',\n         'role_id',\n+        'email_verified_at',\n+        'phone_verified_at',\n     ];\n \n     /**\n      * The attributes that should be hidden for serialization.\n@@ -49,66 +56,62 @@\n         'mpin',\n         'remember_token',\n     ];\n \n-    /* Get the attributes that should be cast.\n-\n+    /**\n+     * Get the attributes that should be cast.\n+     *\n      * @return array<string, string>\n      */\n     protected function casts(): array\n     {\n         return [\n             'email_verified_at' => 'datetime',\n+             'phone_verified_at' => 'datetime',\n             'password' => 'hashed',\n         ];\n     }\n \n-    /*Boot method - automatically create credit score when user is created*/\n-    protected static function booted()\n-    {\n-        static::created(function ($user) {\n-            CreditScore::create([\n-                'user_id' => $user->id,\n-                'score' => 20\n-            ]);\n-        });\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n \n-    // --- Relationships ---\n+    //RELATIONSHIP TO USERS\\\n \n-    public function role()\n-    {\n+    //for role: each user belongs to a role (1:1)\n+    public function role(){\n         return $this->belongsTo(Role::class);\n     }\n \n-    public function userInfo(): HasOne\n-    {\n+    //for user_info: sa web\n+    public function user_info(){\n         return $this->hasOne(UserInfo::class);\n     }\n \n-    public function applications()\n-    {\n+    //for user_info: sa mobile ini\n+    public function userInfo(){\n+        return $this->hasOne(UserInfo::class);\n+    }\n+\n+    //for applications: a user can submit many applications (1:M)\n+    public function applications(){\n         return $this->hasMany(Application::class);\n     }\n \n-    public function documents()\n-    {\n+    //for documents: a user can upload many documents (polymorphic relation)\n+    public function documents(){\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->belongsToMany(Training::class, 'participants')\n-                    ->withPivot('qr_scanned', 'check_in_at')\n-                    ->withTimestamps();\n+    //for trainings: a user can attend many trainings\n+    public function trainings(){\n+        return $this->hasMany(Training::class, 'participants');\n     }\n \n-\n-    public function notifications()\n-    {\n+    //for notifications: a user can have many notifications\n+    public function notifications(){\n         return $this->hasMany(Notification::class);\n     }\n-\n     /**\n      * Get the credit score for the user.\n      */\n     public function creditScore(): HasOne\n@@ -123,39 +126,73 @@\n     {\n         return $this->hasMany(CreditScoreHistory::class)->latest();\n     }\n \n-     /*Adjust the user's credit score and log it in history*/\n-    public function adjustCreditScore(int $points, string $activity)\n+    /**\n+     * Get phone OTP records for this user\n+     */\n+    public function phoneOtps()\n     {\n-        // Get or create credit score\n-        $creditScore = $this->creditScore()->firstOrCreate(\n-            ['user_id' => $this->id],\n-            ['score' => 20]\n-        );\n+        return $this->hasMany(PhoneOtp::class, 'phone_number', 'phone_number');\n+    }\n \n-        // Update the score\n-        $newScore = $creditScore->score + $points;\n-        \n-        // Don't let score go below 0\n-        $newScore = max(0, $newScore);\n-        \n-        $creditScore->update(['score' => $newScore]);\n+    /**\n+     * Get latest phone OTP\n+     */\n+    public function latestPhoneOtp()\n+    {\n+        return $this->hasOne(PhoneOtp::class, 'phone_number', 'phone_number')\n+            ->latestOfMany();\n+    }\n \n-        // Log in history\n-        CreditScoreHistory::create([\n-            'user_id' => $this->id,\n-            'activity' => $activity,\n-            'points' => $points,\n-        ]);\n+    /**\n+     * Check if user's phone is verified\n+     */\n+    public function isPhoneVerified(): bool\n+    {\n+        return $this->phone_verified_at !== null;\n+    }\n \n-        return $newScore;\n+    /**\n+     * Check if user's email is verified\n+     */\n+    public function isEmailVerified(): bool\n+    {\n+        return $this->email_verified_at !== null;\n     }\n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+\n+    /**\n+     * Get user's full name\n+     */\n+    public function getFullNameAttribute(): string\n+    {\n+        $name = trim(\"{$this->first_name} {$this->middle_name} {$this->last_name}\");\n+        if ($this->suffix && $this->suffix !== 'N/A') {\n+            $name .= \" {$this->suffix}\";\n+        }\n+        return $name;\n     }\n-    public function getNameAttribute()\n+\n+    /**\n+     * Get user's identifier (email or phone)\n+     */\n+    public function getIdentifierAttribute(): string\n     {\n-        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n+        return $this->email ?? $this->phone_number ?? 'Unknown';\n     }\n \n+    /**\n+     * Check if user registered with email\n+     */\n+    public function isEmailUser(): bool\n+    {\n+        return $this->login_method === 'email' || !empty($this->email);\n+    }\n+\n+    /**\n+     * Check if user registered with phone\n+     */\n+    public function isPhoneUser(): bool\n+    {\n+        return $this->login_method === 'phone' || !empty($this->phone_number);\n+    }\n }\n"
                },
                {
                    "date": 1764940340123,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable implements MustVerifyEmail\n+class User extends Authenticatable \n {\n     use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n"
                },
                {
                    "date": 1764940594830,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -194,5 +194,12 @@\n     public function isPhoneUser(): bool\n     {\n         return $this->login_method === 'phone' || !empty($this->phone_number);\n     }\n+        public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    }\n+    public function getNameAttribute()\n+    {\n+        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n+    }\n }\n"
                },
                {
                    "date": 1764940618134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,11 +70,9 @@\n             'password' => 'hashed',\n         ];\n     }\n \n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n-    }\n+\\\n \n     //RELATIONSHIP TO USERS\\\n \n     //for role: each user belongs to a role (1:1)\n"
                },
                {
                    "date": 1764941023581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable \n+class User extends Authenticatable implements MustVerifyEmail\n {\n     use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n@@ -70,9 +70,11 @@\n             'password' => 'hashed',\n         ];\n     }\n \n-\\\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    }\n \n     //RELATIONSHIP TO USERS\\\n \n     //for role: each user belongs to a role (1:1)\n@@ -192,12 +194,5 @@\n     public function isPhoneUser(): bool\n     {\n         return $this->login_method === 'phone' || !empty($this->phone_number);\n     }\n-        public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n-    }\n-    public function getNameAttribute()\n-    {\n-        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n-    }\n }\n"
                },
                {
                    "date": 1764941036355,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n use App\\Models\\PhoneOtp;\n \n-class User extends Authenticatable implements MustVerifyEmail\n+class User extends Authenticatable\n {\n     use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n"
                },
                {
                    "date": 1764944385996,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,50 +1,43 @@\n <?php\n \n namespace App\\Models;\n \n-use Illuminate\\Contracts\\Auth\\MustVerifyEmail;\n use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n use Illuminate\\Foundation\\Auth\\User as Authenticatable;\n use Illuminate\\Notifications\\Notifiable;\n-\n+use Laravel\\Sanctum\\HasApiTokens;\n use App\\Models\\Role;\n use App\\Models\\Application;\n use App\\Models\\Document;\n use App\\Models\\Notification;\n use App\\Models\\Training;\n use App\\Models\\UserInfo;\n-use Laravel\\Sanctum\\HasApiTokens;\n use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n-use App\\Models\\PhoneOtp;\n \n class User extends Authenticatable\n {\n-    use HasFactory, HasApiTokens, Notifiable;\n+    use HasFactory, Notifiable, HasApiTokens;\n \n     /**\n      * The attributes that are mass assignable.\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name', // alion nalang pag okay na\n+        'name',\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n         'email',\n         'password',\n         'phone_number',\n         'mpin',\n-        'qr_code',\n-        'login_method',\n         'role_id',\n-        'email_verified_at',\n-        'phone_verified_at',\n     ];\n \n     /**\n      * The attributes that should be hidden for serialization.\n@@ -56,62 +49,66 @@\n         'mpin',\n         'remember_token',\n     ];\n \n-    /**\n-     * Get the attributes that should be cast.\n-     *\n+    /* Get the attributes that should be cast.\n+\n      * @return array<string, string>\n      */\n     protected function casts(): array\n     {\n         return [\n             'email_verified_at' => 'datetime',\n-             'phone_verified_at' => 'datetime',\n             'password' => 'hashed',\n         ];\n     }\n \n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+    /*Boot method - automatically create credit score when user is created*/\n+    protected static function booted()\n+    {\n+        static::created(function ($user) {\n+            CreditScore::create([\n+                'user_id' => $user->id,\n+                'score' => 20\n+            ]);\n+        });\n     }\n \n-    //RELATIONSHIP TO USERS\\\n+    // --- Relationships ---\n \n-    //for role: each user belongs to a role (1:1)\n-    public function role(){\n+    public function role()\n+    {\n         return $this->belongsTo(Role::class);\n     }\n \n-    //for user_info: sa web\n-    public function user_info(){\n+    public function userInfo(): HasOne\n+    {\n         return $this->hasOne(UserInfo::class);\n     }\n \n-    //for user_info: sa mobile ini\n-    public function userInfo(){\n-        return $this->hasOne(UserInfo::class);\n-    }\n-\n-    //for applications: a user can submit many applications (1:M)\n-    public function applications(){\n+    public function applications()\n+    {\n         return $this->hasMany(Application::class);\n     }\n \n-    //for documents: a user can upload many documents (polymorphic relation)\n-    public function documents(){\n+    public function documents()\n+    {\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    //for trainings: a user can attend many trainings\n-    public function trainings(){\n-        return $this->hasMany(Training::class, 'participants');\n+    public function trainings()\n+    {\n+        return $this->belongsToMany(Training::class, 'participants')\n+                    ->withPivot('qr_scanned', 'check_in_at')\n+                    ->withTimestamps();\n     }\n \n-    //for notifications: a user can have many notifications\n-    public function notifications(){\n+\n+    public function notifications()\n+    {\n         return $this->hasMany(Notification::class);\n     }\n+\n     /**\n      * Get the credit score for the user.\n      */\n     public function creditScore(): HasOne\n@@ -126,73 +123,39 @@\n     {\n         return $this->hasMany(CreditScoreHistory::class)->latest();\n     }\n \n-    /**\n-     * Get phone OTP records for this user\n-     */\n-    public function phoneOtps()\n+     /*Adjust the user's credit score and log it in history*/\n+    public function adjustCreditScore(int $points, string $activity)\n     {\n-        return $this->hasMany(PhoneOtp::class, 'phone_number', 'phone_number');\n-    }\n+        // Get or create credit score\n+        $creditScore = $this->creditScore()->firstOrCreate(\n+            ['user_id' => $this->id],\n+            ['score' => 20]\n+        );\n \n-    /**\n-     * Get latest phone OTP\n-     */\n-    public function latestPhoneOtp()\n-    {\n-        return $this->hasOne(PhoneOtp::class, 'phone_number', 'phone_number')\n-            ->latestOfMany();\n-    }\n+        // Update the score\n+        $newScore = $creditScore->score + $points;\n+        \n+        // Don't let score go below 0\n+        $newScore = max(0, $newScore);\n+        \n+        $creditScore->update(['score' => $newScore]);\n \n-    /**\n-     * Check if user's phone is verified\n-     */\n-    public function isPhoneVerified(): bool\n-    {\n-        return $this->phone_verified_at !== null;\n-    }\n+        // Log in history\n+        CreditScoreHistory::create([\n+            'user_id' => $this->id,\n+            'activity' => $activity,\n+            'points' => $points,\n+        ]);\n \n-    /**\n-     * Check if user's email is verified\n-     */\n-    public function isEmailVerified(): bool\n-    {\n-        return $this->email_verified_at !== null;\n+        return $newScore;\n     }\n-\n-    /**\n-     * Get user's full name\n-     */\n-    public function getFullNameAttribute(): string\n-    {\n-        $name = trim(\"{$this->first_name} {$this->middle_name} {$this->last_name}\");\n-        if ($this->suffix && $this->suffix !== 'N/A') {\n-            $name .= \" {$this->suffix}\";\n-        }\n-        return $name;\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n-\n-    /**\n-     * Get user's identifier (email or phone)\n-     */\n-    public function getIdentifierAttribute(): string\n+    public function getNameAttribute()\n     {\n-        return $this->email ?? $this->phone_number ?? 'Unknown';\n+        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n     }\n \n-    /**\n-     * Check if user registered with email\n-     */\n-    public function isEmailUser(): bool\n-    {\n-        return $this->login_method === 'email' || !empty($this->email);\n-    }\n-\n-    /**\n-     * Check if user registered with phone\n-     */\n-    public function isPhoneUser(): bool\n-    {\n-        return $this->login_method === 'phone' || !empty($this->phone_number);\n-    }\n }\n"
                },
                {
                    "date": 1764944399821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,50 @@\n <?php\n \n namespace App\\Models;\n \n+use Illuminate\\Contracts\\Auth\\MustVerifyEmail;\n use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n use Illuminate\\Foundation\\Auth\\User as Authenticatable;\n use Illuminate\\Notifications\\Notifiable;\n-use Laravel\\Sanctum\\HasApiTokens;\n+\n use App\\Models\\Role;\n use App\\Models\\Application;\n use App\\Models\\Document;\n use App\\Models\\Notification;\n use App\\Models\\Training;\n use App\\Models\\UserInfo;\n+use Laravel\\Sanctum\\HasApiTokens;\n use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n use App\\Models\\CreditScore;\n use App\\Models\\CreditScoreHistory;\n+use App\\Models\\PhoneOtp;\n \n class User extends Authenticatable\n {\n-    use HasFactory, Notifiable, HasApiTokens;\n+    use HasFactory, HasApiTokens, Notifiable;\n \n     /**\n      * The attributes that are mass assignable.\n      *\n      * @var array<int, string>\n      */\n     protected $fillable = [\n-        'name',\n+        'name', // alion nalang pag okay na\n         'first_name',\n         'last_name',\n         'middle_name',\n         'suffix',\n         'email',\n         'password',\n         'phone_number',\n         'mpin',\n+        'qr_code',\n+        'login_method',\n         'role_id',\n+        'email_verified_at',\n+        'phone_verified_at',\n     ];\n \n     /**\n      * The attributes that should be hidden for serialization.\n@@ -49,66 +56,62 @@\n         'mpin',\n         'remember_token',\n     ];\n \n-    /* Get the attributes that should be cast.\n-\n+    /**\n+     * Get the attributes that should be cast.\n+     *\n      * @return array<string, string>\n      */\n     protected function casts(): array\n     {\n         return [\n             'email_verified_at' => 'datetime',\n+             'phone_verified_at' => 'datetime',\n             'password' => 'hashed',\n         ];\n     }\n \n-    /*Boot method - automatically create credit score when user is created*/\n-    protected static function booted()\n-    {\n-        static::created(function ($user) {\n-            CreditScore::create([\n-                'user_id' => $user->id,\n-                'score' => 20\n-            ]);\n-        });\n+    public function getFormattedIdAttribute(){\n+        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n     }\n \n-    // --- Relationships ---\n+    //RELATIONSHIP TO USERS\\\n \n-    public function role()\n-    {\n+    //for role: each user belongs to a role (1:1)\n+    public function role(){\n         return $this->belongsTo(Role::class);\n     }\n \n-    public function userInfo(): HasOne\n-    {\n+    //for user_info: sa web\n+    public function user_info(){\n         return $this->hasOne(UserInfo::class);\n     }\n \n-    public function applications()\n-    {\n+    //for user_info: sa mobile ini\n+    public function userInfo(){\n+        return $this->hasOne(UserInfo::class);\n+    }\n+\n+    //for applications: a user can submit many applications (1:M)\n+    public function applications(){\n         return $this->hasMany(Application::class);\n     }\n \n-    public function documents()\n-    {\n+    //for documents: a user can upload many documents (polymorphic relation)\n+    public function documents(){\n         return $this->morphMany(Document::class, 'documentable');\n     }\n \n-    public function trainings()\n-    {\n-        return $this->belongsToMany(Training::class, 'participants')\n-                    ->withPivot('qr_scanned', 'check_in_at')\n-                    ->withTimestamps();\n+    //for trainings: a user can attend many trainings\n+    public function trainings(){\n+        return $this->hasMany(Training::class, 'participants');\n     }\n \n-\n-    public function notifications()\n-    {\n+    //for notifications: a user can have many notifications\n+    public function notifications(){\n         return $this->hasMany(Notification::class);\n     }\n-\n     /**\n      * Get the credit score for the user.\n      */\n     public function creditScore(): HasOne\n@@ -123,39 +126,73 @@\n     {\n         return $this->hasMany(CreditScoreHistory::class)->latest();\n     }\n \n-     /*Adjust the user's credit score and log it in history*/\n-    public function adjustCreditScore(int $points, string $activity)\n+    /**\n+     * Get phone OTP records for this user\n+     */\n+    public function phoneOtps()\n     {\n-        // Get or create credit score\n-        $creditScore = $this->creditScore()->firstOrCreate(\n-            ['user_id' => $this->id],\n-            ['score' => 20]\n-        );\n+        return $this->hasMany(PhoneOtp::class, 'phone_number', 'phone_number');\n+    }\n \n-        // Update the score\n-        $newScore = $creditScore->score + $points;\n-        \n-        // Don't let score go below 0\n-        $newScore = max(0, $newScore);\n-        \n-        $creditScore->update(['score' => $newScore]);\n+    /**\n+     * Get latest phone OTP\n+     */\n+    public function latestPhoneOtp()\n+    {\n+        return $this->hasOne(PhoneOtp::class, 'phone_number', 'phone_number')\n+            ->latestOfMany();\n+    }\n \n-        // Log in history\n-        CreditScoreHistory::create([\n-            'user_id' => $this->id,\n-            'activity' => $activity,\n-            'points' => $points,\n-        ]);\n+    /**\n+     * Check if user's phone is verified\n+     */\n+    public function isPhoneVerified(): bool\n+    {\n+        return $this->phone_verified_at !== null;\n+    }\n \n-        return $newScore;\n+    /**\n+     * Check if user's email is verified\n+     */\n+    public function isEmailVerified(): bool\n+    {\n+        return $this->email_verified_at !== null;\n     }\n-    public function getFormattedIdAttribute(){\n-        return 'MEM-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);\n+\n+    /**\n+     * Get user's full name\n+     */\n+    public function getFullNameAttribute(): string\n+    {\n+        $name = trim(\"{$this->first_name} {$this->middle_name} {$this->last_name}\");\n+        if ($this->suffix && $this->suffix !== 'N/A') {\n+            $name .= \" {$this->suffix}\";\n+        }\n+        return $name;\n     }\n-    public function getNameAttribute()\n+\n+    /**\n+     * Get user's identifier (email or phone)\n+     */\n+    public function getIdentifierAttribute(): string\n     {\n-        return trim(\"{$this->first_name} {$this->middle_name} {$this->last_name} {$this->suffix}\");\n+        return $this->email ?? $this->phone_number ?? 'Unknown';\n     }\n \n+    /**\n+     * Check if user registered with email\n+     */\n+    public function isEmailUser(): bool\n+    {\n+        return $this->login_method === 'email' || !empty($this->email);\n+    }\n+\n+    /**\n+     * Check if user registered with phone\n+     */\n+    public function isPhoneUser(): bool\n+    {\n+        return $this->login_method === 'phone' || !empty($this->phone_number);\n+    }\n }\n"
                },
                {
                    "date": 1764944409972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -194,5 +194,13 @@\n     public function isPhoneUser(): bool\n     {\n         return $this->login_method === 'phone' || !empty($this->phone_number);\n     }\n+\n+\n+\n+    public function participants()\n+{\n+    return $this->hasMany(\\App\\Models\\Participant::class, 'user_id');\n }\n+\n+}\n"
                },
                {
                    "date": 1764959713324,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -197,10 +197,17 @@\n     }\n \n \n \n-    public function participants()\n+public function participants()\n {\n     return $this->hasMany(\\App\\Models\\Participant::class, 'user_id');\n }\n \n+\n+\n+public function activityHistory()\n+{\n+    return $this->hasMany(\\App\\Models\\ActivityHistory::class, 'user_id');\n }\n+\n+}\n"
                }
            ],
            "date": 1763817552348,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\nuse Illuminate\\Foundation\\Auth\\User as Authenticatable;\nuse Illuminate\\Notifications\\Notifiable;\nuse Laravel\\Sanctum\\HasApiTokens;\nuse App\\Models\\Role;\nuse App\\Models\\Application;\nuse App\\Models\\Document;\nuse App\\Models\\Notification;\nuse App\\Models\\Training;\nuse App\\Models\\UserInfo;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOne;\nuse App\\Models\\CreditScore;\nuse App\\Models\\CreditScoreHistory;\n\nclass User extends Authenticatable\n{\n    use HasFactory, Notifiable, HasApiTokens;\n\n    /**\n     * The attributes that are mass assignable.\n     *\n     * @var array<int, string>\n     */\n    protected $fillable = [\n        'first_name',\n        'last_name',\n        'middle_name',\n        'suffix',\n        'email',\n        'password',\n        'phone_number',\n        'mpin',\n        'role_id',\n    ];\n\n    /**\n     * The attributes that should be hidden for serialization.\n     *\n     * @var array<int, string>\n     */\n    protected $hidden = [\n        'password',\n        'mpin',\n        'remember_token',\n    ];\n\n    /* Get the attributes that should be cast.\n\n     * @return array<string, string>\n     */\n    protected function casts(): array\n    {\n        return [\n            'email_verified_at' => 'datetime',\n            'password' => 'hashed',\n        ];\n    }\n\n    /*Boot method - automatically create credit score when user is created*/\n    protected static function booted()\n    {\n        static::created(function ($user) {\n            CreditScore::create([\n                'user_id' => $user->id,\n                'score' => 20\n            ]);\n        });\n    }\n\n    // --- Relationships ---\n\n    public function role()\n    {\n        return $this->belongsTo(Role::class);\n    }\n\n    public function userInfo(): HasOne\n    {\n        return $this->hasOne(UserInfo::class);\n    }\n\n    public function applications()\n    {\n        return $this->hasMany(Application::class);\n    }\n\n    public function documents()\n    {\n        return $this->morphMany(Document::class, 'documentable');\n    }\n\npublic function trainings()\n{\n    return $this->belongsToMany(Training::class, 'participants')\n                ->withPivot('qr_scanned', 'check_in_at')\n                ->withTimestamps();\n}\n\n    public function notifications()\n    {\n        return $this->hasMany(Notification::class);\n    }\n\n    /**\n     * Get the credit score for the user.\n     */\n    public function creditScore(): HasOne\n    {\n        return $this->hasOne(CreditScore::class);\n    }\n\n    /**\n     * Get the credit score history for the user.\n     */\n    public function creditScoreHistory(): HasMany\n    {\n        return $this->hasMany(CreditScoreHistory::class)->latest();\n    }\n\n     /*Adjust the user's credit score and log it in history*/\n    public function adjustCreditScore(int $points, string $activity)\n    {\n        // Get or create credit score\n        $creditScore = $this->creditScore()->firstOrCreate(\n            ['user_id' => $this->id],\n            ['score' => 20]\n        );\n\n        // Update the score\n        $newScore = $creditScore->score + $points;\n        \n        // Don't let score go below 0\n        $newScore = max(0, $newScore);\n        \n        $creditScore->update(['score' => $newScore]);\n\n        // Log in history\n        CreditScoreHistory::create([\n            'user_id' => $this->id,\n            'activity' => $activity,\n            'points' => $points,\n        ]);\n\n        return $newScore;\n    }\n}\n"
        }
    ]
}